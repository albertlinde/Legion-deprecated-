"use strict";function LegionRealtimeUtils(e){this.realtimeUtils=e,this.id=null,this.legion=null,this.objectStore=null,this.merge_to_legacy=!0,this.signalling_on_legacy=!0,this.persitence_on_legacy=!0,this.FileID_Original=null,this.FileID_Overlay=null,this.FileID_Objects=null,this.map=null,this.constants={FileID_Overlay:"FileID_Overlay",FileID_Objects:"FileID_Objects",FileID_Merge:"FileID_Merge",FileID_MainBully:"FileID_MainBully",objectsMap:"RootMap",WAIT_ON_MAP_INIT:3e3},this.mergeUtils=new MergeUtils(this),this.revisions=new ALMap}function GapiInterfaceHandler(e,t){this.objects=e,this.map=t}function GapiObjectHandler(e){this.object=e}function getPropertyFromFile(e,t,n){var i=gapi.client.drive.properties.get({fileId:e,propertyKey:t,visibility:"PUBLIC"});i.execute(function(e){n(e.value)})}function addPropertyToFile(e,t,n,i){var r={key:t,value:n,visibility:"PUBLIC"},o=gapi.client.drive.properties.insert({fileId:e,resource:r});o.execute(function(e){i(e)})}function getCurrentRevision(e,t){var n=gapi.client.drive.realtime.get({fileId:e});n.execute(function(e){t(e)})}function drive_realtime_file_put(e,t,n,i){var r=gapi.client.request({path:"/upload/drive/v2/files/"+e+"/realtime",method:"PUT",params:{uploadType:"media",fileId:e,baseRevision:n},body:JSON.stringify(t)});r.execute(function(){i()})}function MainBullyProtocol(e){this.lru=e,this.bossTime=45e3,this.renewTime=2e4,this.MainBullyMap=null}function MergeUtils(e){this.lru=e,this.map=null,this.doc=null}function GDriveRTObjectsServerConnection(e,t,n){this.argument=e,this.objectStore=t,this.legion=n,this.lru=n.lru,this.remoteID=this.lru.FileID_Objects,this.onclose=function(){i.legion.connectionManager.onCloseServer(i)},this.document=null,this.model=null;var i=this;this.lru.realtimeUtils.load(this.lru.FileID_Objects.replace("/",""),function(e){i.document=e,i.model=e.getModel(),i.legion.connectionManager.onOpenServer(i)},function(){console.error("File init should have been done!")})}function GDriveRTSignallingServerConnection(e,t){this.argument=e,this.legion=t,this.lru=t.lru,this.onmessage=function(e){decompress(e,function(t){var n=JSON.parse(t);manager.onMessageServer("overlayDocument",n.group,n,e.length,t.length)})},this.onclose=function(){manager.onCloseServer("overlayDocument",group)};var n=this;this.lru.realtimeUtils.load(this.lru.FileID_Overlay.replace("/",""),function(e){n.document=e,n.model=e.getModel(),"TEMP_ID"==n.id&&n.setID(),n.initOverlay()},function(e){var t=e.createMap({B2B_MAP:B2B_MAP});e.getRoot().set(B2B_MAP,t)}),this.onObjects=!0}function getJasmineRequireObj(){return"undefined"!=typeof module&&module.exports?exports:(window.jasmineRequire=window.jasmineRequire||{},window.jasmineRequire)}function getJasmineRequireObj(){return"undefined"!=typeof module&&module.exports?exports:(window.jasmineRequire=window.jasmineRequire||{},window.jasmineRequire)}LegionRealtimeUtils.prototype.load=function(e,t,n){this.FileID_Original=e;var i=this;gapi.client.drive?getPropertyFromFile(e,i.constants.FileID_Overlay,function(r){r?(i.FileID_Overlay=r,i.gotOverlayFile(t)):i.realtimeUtils.load(e,function(r){r.close(),i.realtimeUtils.createRealtimeFile(i.constants.FileID_Overlay,function(r){addPropertyToFile(e,i.constants.FileID_Overlay,r.id,function(){i.load(e,t,n)})})},function(e){n(e)})}):gapi.client.load("drive","v2",function(){i.load(e,t,n)})},LegionRealtimeUtils.prototype.gotOverlayFile=function(e){var t,n;this.signalling_on_legacy?(t=ServerConnection,n={ip:"localhost",port:8002}):(t=GDriveRTSignallingServerConnection,n={});var i,r;this.persitence_on_legacy?(i=ObjectServerConnection,r={ip:"localhost",port:8004}):(i=GDriveRTObjectsServerConnection,r={});var o={clientID:"TEMP_ID",overlayProtocol:SimpleOverlay,messagingProtocol:FloodMessaging,objectOptions:{serverInterval:5e3,peerInterval:2e3},bullyProtocol:{type:SimpleBully,options:{bullyMustHaveInterval:15e3,bullySendInterval:7e3,bullyStartTime:2e3}},signallingConnection:{type:t,server:n},objectServerConnection:{type:i,server:r}};this.legion=new Legion(o),this.legion.lru=this,this.legion.join(),this.objectStore=this.legion.getObjectStore(),this.objectStore.defineCRDT(CRDT_LIB.OP_List),this.objectStore.defineCRDT(CRDT_LIB.OP_ORMap),this.map=this.objectStore.get(this.constants.objectsMap,CRDT_LIB.OP_ORSet.type),this.gotMap(e),this.startObjectsProtocol()},LegionRealtimeUtils.prototype.gotMap=function(e){var t=this,n=this.map.keys();if(0==n.length)console.log("Waiting on map init."),setTimeout(function(){t.gotMap(e)},this.constants.WAIT_ON_MAP_INIT);else{for(var i=[],r=0;r<n.length;r++){var o=this.map.get(n[r])[0];switch(o){case"Map":console.info("Object init: "+o+" ID: "+n[r]),i[n[r]]=objectStore.get(n[r],CRDT_LIB.OP_ORMap.type);break;case"List":console.info("Object init: "+o+" ID: "+n[r]),i[n[r]]=objectStore.get(n[r],CRDT_LIB.OP_List.type);break;case"String":console.error("Not implemented: strings")}}this.interfaceHandler=new GapiInterfaceHandler(i,this.map),e(this.interfaceHandler)}},LegionRealtimeUtils.prototype.startObjectsProtocol=function(){var e=this.map,t=this,n=e.keys();0==n.length?(console.log("Got an empty RootMap."),this.FileID_Objects?setTimeout(function(){t.startObjectsProtocol()},t.constants.WAIT_ON_MAP_INIT):getPropertyFromFile(t.FileID_Original,t.constants.FileID_Objects,function(e){e?(t.FileID_Objects=e,t.startObjectsProtocol()):t.checkIfMainBully(function(e){e?t.initRootMap(function(){t.startObjectsProtocol()}):(console.log("I am not the main bully, waiting."),setTimeout(function(){t.startObjectsProtocol()},t.constants.WAIT_ON_MAP_INIT))})})):(console.log("Got a filled RootMap."),t.merge_to_legacy&&setInterval(function(){t.checkIfMainBully(function(e){e&&(console.log("Try to write to Merge and Original file."),t.mergeFiles())})},1e4))},LegionRealtimeUtils.prototype.mergeFiles=function(){if(this.FileID_Merge)this.mergeUtils.mergeFiles();else{var e=this;getPropertyFromFile(this.FileID_Original,this.constants.FileID_Merge,function(t){t?(e.FileID_Merge=t,e.mergeFiles()):console.error("FileID_Merge does not exists!")})}},LegionRealtimeUtils.prototype.initRootMap=function(e){function t(e,n){if(console.log("initObject: "+e.id+" - "+e.type),e.id){if("Map"==e.type){console.info("Init Map with id: "+e.id),r.set(e.id,"Map");var s=o.get(e.id,CRDT_LIB.OP_ORMap.type);i[e.id]=s;for(var a=Object.keys(e.value),l=0;l<a.length;l++){var c=a[l],u=e.value[c];t(u,n+"|"+e.id)}}if("List"==e.type){console.info("Init List with id: "+e.id),r.set(e.id,"List"),i[e.id]=o.get(e.id,CRDT_LIB.OP_List.type);for(var f=0;f<e.value.length;f++)t(e.value[f],n+"|"+e.id)}"EditableString"==e.type&&console.error("Not implemented: EditableString")}e.ref&&console.info("Ref id: "+e.ref+" in: "+n),e.json&&console.info("Json in: "+n)}function n(e,t){if(e.id){if("Map"==e.type){r.set(e.id,"Map");for(var o=Object.keys(e.value),s=0;s<o.length;s++){var a=o[s],l=e.value[a];l.id?i[e.id].set(a,i[l.id]):l.ref?i[e.id].set(a,i[l.ref]):l.json&&i[e.id].set(a,l.json),n(l,t+"|"+e.id)}}if("List"==e.type){r.set(e.id,"List");for(var c=0;c<e.value.length;c++){var u=e.value[c];u.id?i[e.id].insert(c,i[u.id]):u.ref?i[e.id].insert(c,i[u.ref]):u.json&&i[e.id].insert(c,u.json),n(e.value[c],t+"|"+e.id)}}"EditableString"==e.type&&console.error("Not implemented: EditableString")}e.ref,e.json}console.log("initRootMap start");var i=[],r=this.map,o=this.objectStore;getCurrentRevision(this.FileID_Original,function(i){lru.revisions.set(parseInt(i.revision),i);for(var o,s,a=Object.keys(i.result.data.value),l=0;l<a.length;l++)o=a[l],s=i.result.data.value[o],t(s,"root");for(var c=0;c<a.length;c++)o=a[c],s=i.result.data.value[o],s.id&&r.set(o,s.id),n(s,"root");console.log("createObjectsFile"),lru.createObjectsFile(function(){console.log("createMergeFile"),lru.createMergeFile(function(){console.log("initRootMap end"),e()})})})},LegionRealtimeUtils.prototype.checkIfMainBully=function(e){this.mbp||(this.mbp=new MainBullyProtocol(this)),this.mbp.checkIfMainBully(e)},LegionRealtimeUtils.prototype.createMergeFile=function(e,t,n){console.log("createMergeFile start"),this.FileID_Merge?realtimeUtils.load(this.FileID_Merge.replace("/",""),function(e){console.log("createMergeFile end"),e.close(),n()},function(e){var t=lru.revisions.keys(),n=t.sort()[t.length-1],i=lru.revisions.get(n),r=lru.mergeUtils.getLocalValue(),o=e.createMap({FileID_Original:lru.FileID_Original,gapi:{num:n,val:i},b2b:{val:r}});e.getRoot().set("b2b_map",o)}):getPropertyFromFile(lru.FileID_Original,lru.constants.FileID_Merge,function(i){i?(console.log("createMergeFile: "+i),lru.FileID_Merge=i,lru.createMergeFile(e,t,n)):lru.realtimeUtils.createRealtimeFile(lru.constants.FileID_Merge,function(i){addPropertyToFile(lru.FileID_Original,lru.constants.FileID_Merge,i.id,function(){lru.createMergeFile(e,t,n)})})})},LegionRealtimeUtils.prototype.createObjectsFile=function(e){console.log("createObjectsFile start");var t=this.map,n=this;this.FileID_Objects?this.realtimeUtils.load(this.FileID_Objects.replace("/",""),function(t){console.log("createObjectsFile end"),t.close(),e()},function(e){var i=e.createMap({FileID_Original:n.FileID_Original,RootMap:CRDT_LIB.OP_ORMap.type}),r=e.createList();e.getRoot().set("RootMap",r);for(var o=t.getVersionVector(),s=n.objectStore.versionVectorDiff(o,[]),a=t.getOperations(s.vv2.missing),l=0;l<a.length;l++)r.insert(l,a[l]);for(var c=t.keys(),l=0;l<c.length;l++){var u=c[l],f=n.objectStore.getCRDT(u);i.set(u,f.crdt.type);var r=e.createList();if(e.getRoot().set(u,r),f.crdt.propagation==CRDT.STATE_BASED)r.insert(0,f.toJSONString(f.getState()));else if(f.crdt.propagation==CRDT.OP_BASED)for(var o=f.getVersionVector(),s=n.objectStore.versionVectorDiff(o,[]),a=f.getOperations(s.vv2.missing),l=0;l<a.length;l++)r.insert(l,a[l])}e.getRoot().set("b2b_map",i)}):getPropertyFromFile(n.FileID_Original,n.constants.FileID_Objects,function(i){i?(console.log("createObjectsFile: "+i),n.FileID_Objects=i,n.createObjectsFile(t,objects,e)):n.realtimeUtils.createRealtimeFile(n.constants.FileID_Objects,function(i){addPropertyToFile(n.FileID_Original,n.constants.FileID_Objects,i.id,function(){n.createObjectsFile(t,objects,e)})})})},LegionRealtimeUtils.prototype.amBully=function(){return!this.legion.bullyProtocol.amBullied()},GapiInterfaceHandler.prototype.getModel=function(){return this},GapiInterfaceHandler.prototype.getRoot=function(){return this},GapiInterfaceHandler.prototype.get=function(e){return new GapiObjectHandler(this.objects[this.map.get(e)])},GapiObjectHandler.prototype.items=function(){return this.object.items()},GapiObjectHandler.prototype.keys=function(){return this.object.keys()},GapiObjectHandler.prototype.remove=function(e){this.object.remove(e)},GapiObjectHandler.prototype.insert=function(e,t){this.object.insert(e,t)},GapiObjectHandler.prototype.has=function(e){return this.object.contains(e)},GapiObjectHandler.prototype["delete"]=function(e){this.object.remove(e)},GapiObjectHandler.prototype.set=function(e,t){this.object.set(e,t)},GapiObjectHandler.prototype.asArray=function(){return this.object.getData()},GapiObjectHandler.prototype.addEventListener=function(e,t){switch(e){case gapi.drive.realtime.EventType.TEXT_INSERTED:this.object.setOnStateChange(function(){t()});break;case gapi.drive.realtime.EventType.TEXT_DELETED:this.object.setOnStateChange(function(){t()});break;case gapi.drive.realtime.EventType.VALUES_ADDED:this.object.setOnStateChange(function(){t()});break;case gapi.drive.realtime.EventType.VALUES_REMOVED:this.object.setOnStateChange(function(){t()});break;case gapi.drive.realtime.EventType.VALUES_SET:this.object.setOnStateChange(function(){t()});break;case gapi.drive.realtime.EventType.VALUE_CHANGED:this.object.setOnStateChange(function(e,n){var i={};i.property=n.key,i.newValue=n.value,t(i)})}},MainBullyProtocol.prototype.setSelfAsMainBully=function(){this.MainBullyMap.set("Main",{id:this.id,start:ServerDate+0,end:ServerDate+this.bossTime})},MainBullyProtocol.prototype.getMainBully=function(){return this.MainBullyMap.get("Main")},MainBullyProtocol.prototype.checkIfMainBully=function(e){if(this.lru.amBully()){var t=this.lru,n=this;if(t.FileID_MainBully)if(this.MainBullyMap){var i=this.getMainBully();i?(console.log("Current main bully:"+JSON.stringify(i)),console.log("Current main bully time left:"+(i.end-ServerDate)),i.start<=ServerDate&&ServerDate<=i.end?(i.id==t.id&&i.end-ServerDate<n.renewTime&&n.setSelfAsMainBully(),e(i.id==n.id)):(n.setSelfAsMainBully(),setTimeout(function(){n.checkIfMainBully(e)},100))):(n.setSelfAsMainBully(),n.checkIfMainBully(e))}else realtimeUtils.load(t.FileID_MainBully.replace("/",""),function(t){n.MainBullyMap=t.getModel().getRoot().get("b2b_map"),n.checkIfMainBully(e)},function(e){var t=e.createMap({FileID_Original:ALru.FileID_Original});e.getRoot().set("b2b_map",t)});else getPropertyFromFile(t.FileID_Original,t.constants.FileID_MainBully,function(i){i?(t.FileID_MainBully=i,n.checkIfMainBully(e)):t.realtimeUtils.createRealtimeFile(t.constants.FileID_MainBully,function(i){addPropertyToFile(t.FileID_Original,t.constants.FileID_MainBully,i.id,function(){n.checkIfMainBully(e)})})})}else e(!1)},MergeUtils.prototype.initMap=function(e){var t=this;realtimeUtils.load(this.ALRU.FileID_Merge.replace("/",""),function(n){t.doc=n,t.map=n.getModel().getRoot().get("b2b_map"),e()},function(){console.error("onFileInitialize: should have been done already!")})},MergeUtils.prototype.newMapValuesFrom=function(e,t,n,i){var r,o,s,a,l,c;switch(n){case"B2B":for(c=e[i],c||(c=[]),r=t[i],o=[],s=Object.keys(r),a=Object.keys(c),l=0;l<s.length;l++)r[s[l]]&&(-1===a.indexOf(s[l])?o[s[l]]=r[s[l]]:JSON.stringify(r[s[l]])!=JSON.stringify(c[s[l]])&&(o[s[l]]=r[s[l]]));return o;case"gapi":var u=this.getObjectFromRev(t,i),f=this.getObjectFromRev(e,i);for(c=f.value,c||(c=[]),a=Object.keys(f.value),s=Object.keys(u.value),r=u.value,o=[],l=0;l<s.length;l++)r[s[l]]&&(-1===a.indexOf(s[l])?o[s[l]]=r[s[l]]:JSON.stringify(r[s[l]])!=JSON.stringify(c[s[l]])&&(o[s[l]]=r[s[l]]));return o}},MergeUtils.prototype.exceptMapValuesFrom=function(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++)e[n[i]]=null,delete e[n[i]];return e},MergeUtils.prototype.delMapValuesFrom=function(e,t,n,i){var r,o,s,a,l;switch(n){case"B2B":r=e[i],r||(r=[]);var c=t[i];for(o=[],s=Object.keys(c),a=Object.keys(r),l=0;l<a.length;l++)r[a[l]]&&-1===s.indexOf(a[l])&&(o[a[l]]=r[a[l]]);return o;case"gapi":var u=this.getObjectFromRev(t,i),f=this.getObjectFromRev(e,i);for(a=Object.keys(f.value),s=Object.keys(u.value),r=f.value,o=[],l=0;l<a.length;l++)r[a[l]]&&-1===s.indexOf(a[l])&&(o[a[l]]=r[a[l]]);return o}},MergeUtils.prototype.getObjectFromRev=function(e,t){for(var n=e.result.data.value,i=Object.keys(n),r=0;r<i.length;r++)if(n[i[r]].id&&n[i[r]].id==t)return n[i[r]];console.error("No object.")},MergeUtils.prototype.mergeMapDiffsToRev=function(e,t,n){for(var i=Object.keys(t),r=Object.keys(n),o=0;o<i.length;o++)e.value[i[o]]={json:t[i[o]]};for(var s=0;s<r.length;s++)e.value[r[o]]=null},MergeUtils.prototype.mergeMapDiffsToB2B=function(e,t,n){for(var i=new ORMap(e,ALru.objectStore,"dontchangecallbacks"),r=Object.keys(t),o=Object.keys(n),s=0;s<r.length;s++)i.set(r[s],t[r[s]].json);for(var a=0;a<o.length;a++)i.remove(o[s])},MergeUtils.prototype.eQUALS_ARRAY=function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0},MergeUtils.prototype.mergeFiles=function(){var e=this,t=this.lru;getCurrentRevision(t.FileID_Original,function(n){if(t.revisions.set(parseInt(n.revision),n),e.doc){var i=e.map.get("gapi"),r=e.map.get("b2b"),o=i.num,s=i.val,a=r.val,l=t.revisions.keys().sort(),c=l[l.length-1],n=t.revisions.get(c);c==o&&(n=s);for(var u,f,h=e.getLocalValue(),p=Object.keys(n.result.data.value),g=!1,d=0;d<p.length;d++)if(u=p[d],f=n.result.data.value[u],f.id)switch(f.type){case"Map":console.info("AAAA - 1");var m=e.newMapValuesFrom(a,h,"B2B",f.id),v=e.delMapValuesFrom(a,h,"B2B",f.id),b=e.newMapValuesFrom(s,n,"gapi",f.id),y=e.delMapValuesFrom(s,n,"gapi",f.id);y=e.exceptMapValuesFrom(y,m),m=e.exceptMapValuesFrom(m,b),v=e.exceptMapValuesFrom(v,b),Object.keys(m).length>0&&(g=!0),Object.keys(v).length>0&&(g=!0),Object.keys(b).length>0&&(g=!0),Object.keys(y).length>0&&(g=!0),e.mergeMapDiffsToRev(f,m,v),e.mergeMapDiffsToB2B(f.id,b,y),console.info("AAAA - 2");break;case"List":console.log("BBBB - 1");for(var _=f.value,S=[],j=h[f.id],M=0;M<_.length;M++)S[M]=_[M],_[M].json&&(S[M]=_[M].json);console.log("BBBB - A");for(var x=e.getObjectFromRev(s,f.id).value,O=[],M=0;M<x.length;M++)O[M]=x[M],x[M].json&&(O[M]=x[M].json);console.log("BBBB - B");var w=Diff.diff3_merge(S,O,j);console.log("BBBB - C");for(var R=[],D=0;D<w.length;D++){var T=w[D];if(T.ok)T.ok.length>0&&(R=R.concat(T.ok));else if(T.conflict){if(T.conflict.a.length>0&&!e.eQUALS_ARRAY(R.slice(R.length-T.conflict.a.length),T.conflict.a))for(var E=0;E<T.conflict.a.length;E++){var F=T.conflict.a[E];-1==T.conflict.b.indexOf(F)&&T.conflict.o.indexOf(F)>=0&&(R=R.concat([F]))}if(T.conflict.b.length>0)for(var E=0;E<T.conflict.b.length;E++){var F=T.conflict.b[E];-1==T.conflict.a.indexOf(F)&&T.conflict.o.indexOf(F)>=0&&(R=R.concat([F]))}}else console.error("Nope.")}console.log("BBBB - D"),f.value=[];for(var C=0;C<R.length;C++)g=!0,f.value[C]={json:R[C]};console.log("BBBB - E");for(var I=new OP_Treedoc(f.id,ALru.objectStore,"dontchangecallbacks"),k=Diff.diff_comm(j,R),A=0,B=0;B<k.length;B++){var N=k[B];if(N.common)A+=N.common.length;else{for(var L=0;L<N.file1.length;L++)g=!0,I.remove(A);for(var U=0;U<N.file2.length;U++)g=!0,I.insert(A++,N.file2[U])}}console.log("BBBB - 2");break;case"EditableString":console.error("Not implemented.")}else console.error("Please don't.");if(g&&drive_realtime_file_put(e.ALRU.FileID_Original,n.result.data,c,function(){}),g){var P={val:e.getLocalValue()};e.map.set("b2b",P)}if(g){var q={num:c,val:n};e.map.set("gapi",q)}}else e.initMap(function(){e.mergeFiles()})})},MergeUtils.prototype.getLocalValue=function(){var e={},t=this.lru.objectStore.getCRDT("RootMap"),n=t.keys();if(0==n.length)console.error("Empty map.");else for(var i=0;i<n.length;i++){var r=this.lru.objectStore.getCRDT(n[i]);switch(r.crdt.type){case CRDT_LIB.OP_ORMap.type:e[n[i]]=r.getValue();break;case CRDT_LIB.OP_List.type:e[n[i]]=r.getValue()}}return e},GDriveRTObjectsServerConnection.prototype.close=function(){this.document.close(),this.document=null,this.model=null,this.onclose()},GDriveRTObjectsServerConnection.prototype.send=function(e){var t=this,n=JSON.parse(e);try{decompress(n.content,function(e){n.content=JSON.parse(e),t.doSend(n)})}catch(i){console.error(event),console.error(n),console.error(original),console.error(i)}},GDriveRTObjectsServerConnection.prototype.doSend=function(e){switch(e.type){case this.objectStore.handlers.peerSync.type:return void this.onSendPeerSync();case this.objectStore.handlers.peerSyncAnswer.type:return void this.onSendPeerSyncAnswer();case this.objectStore.handlers.gotContentFromNetwork.type:return void this.onServerContentFromNetwork();case this.objectStore.handlers.version_vector_propagation.type:console.error("This should never be called.")}console.error(e)},GDriveRTObjectsServerConnection.prototype.onSendPeerSync=function(e){var t=this.document.getModel().getRoot().get("RootMap"),n=t.asArray(),i=this.objectStore.get("RootMap",CRDT_LIB.OP_ORMap.type);i.operationsFromNetwork(n,this);for(var r=this.objectStore.versionVectorDiff(i.getVersionVector(),[]),o=i.getOperations(r.vv2.missing),s=0;s<o.length;s++)this.DriveListHasOP(t,o[s])||t.insert(t.size(),o[s]);for(var a=i.keys(),s=0;s<a.length;s++){var l=a[s],c=this.document.getModel().getRoot().get(l),u=c.asArray(),f=this.objectStore.getCRDT(l);f.operationsFromNetwork(u,this);for(var r=this.objectStore.versionVectorDiff(f.getVersionVector(),[]),o=f.getOperations(r.vv2.missing),s=0;s<o.length;s++)this.DriveListHasOP(c,o[s])||c.insert(c.size(),o[s])}var h={states:[],missing_ops:[]},p=this;this.legion.generateMessage(this.objectStore.handlers.peerSyncAnswer.type,h,function(e){e.content=h,p.onMessageFromServer(e,e,this)})},GDriveRTObjectsServerConnection.prototype.DriveListHasOP=function(e,t){},GDriveRTObjectsServerConnection.prototype.onSendPeerSyncAnswer=function(e){console.error("Won't be called.")},GDriveRTObjectsServerConnection.prototype.onServerContentFromNetwork=function(e){var t=e.content.msg.objectID,n=this.document.getModel().getRoot().get(t);this.DriveListHasOP()||n.insert(n.size(),e.content.msg)};var B2B_MAP="b2bmap";GDriveRTSignallingServerConnection.prototype.close=function(){this.messageList.clear(),this.document.close(),this.messageList=null,this.document=null,this.map=null,this.onclose()},GDriveRTSignallingServerConnection.prototype.initOverlay=function(){var e=this;this.map=this.document.getModel().getRoot().get(B2B_MAP),this.messageList=this.model.createList(),this.model.getRoot().set(this.manager.id,this.messageList),this.map.set(this.manager.id,this.messageList),this.messageList.addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED,function(t){for(var n=0;n<t.values.length;n++)e.onmessage(e.messageList.get(0)),e.messageList.remove(0)}),this.messageList.addEventListener(gapi.drive.realtime.EventType.VALUES_REMOVED,function(e){}),this.messageList.addEventListener(gapi.drive.realtime.EventType.VALUES_SET,function(e){}),this.manager.onOpenServer("overlayDocument",this.group,this)},GDriveRTSignallingServerConnection.prototype.setID=function(){function e(e){for(var t=0;t<e.length;t++)if(e[t].isMe)return{session:e[t].sessionId,user:e[t].userId}}var t=e(this.document.getCollaborators()),n=t.user+"-"+t.session;console.log("Old ID: "+this.legion.id),this.legion.id=n,console.log("New ID: "+this.legion.id)},GDriveRTSignallingServerConnection.prototype.isAlive=function(){return null!=this.document&&!this.document.isClosed},GDriveRTSignallingServerConnection.prototype.send=function(e){switch(e.type){case"OfferAsAnswer":case"OfferReturn":case"ICE":var t=this;this.isAlive()&&compress(e,function(n){t.collabBC(n,e.destination)})}},GDriveRTSignallingServerConnection.prototype.collabBC=function(e,t){function n(e){return e.userId+"-"+e.sessionId}var i,r=this.document.getCollaborators();if(t)for(var o=0;o<r.length;o++)if(!r[o].isMe&&n(r[o])==t)return console.log("Sending toR: "+n(r[o])),i=this.map.get(n(r[o])),void(i&&i.push(e));for(var s=0;s<r.length;s++)r[s].isMe||(console.log("Sending to: "+n(r[s])),i=this.map.get(n(r[s])),i&&i.push(e))};var Diff={longest_common_subsequence:function(e,t){var n,i,r,o,s,a,l,c,u,f,h;for(n={},c=0;c<t.length;c++)s=t[c],n[s]?n[s].push(c):n[s]=[c];for(o=[{file1index:-1,file2index:-1,chain:null}],l=0;l<e.length;l++){for(s=e[l],i=n[s]||[],f=0,a=o[0],u=0;u<i.length;u++){for(c=i[u],h=f;h<o.length&&!(o[h].file2index<c&&(h==o.length-1||o[h+1].file2index>c));h++);if(h<o.length&&(r={file1index:l,file2index:c,chain:o[h]},f==o.length?o.push(a):o[f]=a,f=h+1,a=r,f==o.length))break}o[f]=a}return o[o.length-1]},diff_comm:function(e,t){function n(){s.common.length&&(s.common.reverse(),i.push(s),s={common:[]})}for(var i=[],r=e.length,o=t.length,s={common:[]},a=Diff.longest_common_subsequence(e,t);null!==a;a=a.chain){for(var l={file1:[],file2:[]};--r>a.file1index;)l.file1.push(e[r]);for(;--o>a.file2index;)l.file2.push(t[o]);(l.file1.length||l.file2.length)&&(n(),l.file1.reverse(),l.file2.reverse(),i.push(l)),r>=0&&s.common.push(e[r])}return n(),i.reverse(),i},diff_patch:function(e,t){function n(e,t,n){for(var i=[],r=0;n>r;r++)i.push(e[t+r]);return{offset:t,length:n,chunk:i}}for(var i=[],r=e.length,o=t.length,s=Diff.longest_common_subsequence(e,t);null!==s;s=s.chain){var a=r-s.file1index-1,l=o-s.file2index-1;r=s.file1index,o=s.file2index,(a||l)&&i.push({file1:n(e,s.file1index+1,a),file2:n(t,s.file2index+1,l)})}return i.reverse(),i},strip_patch:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push({file1:{offset:i.file1.offset,length:i.file1.length},file2:{chunk:i.file2.chunk}})}return t},invert_patch:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=n.file1;n.file1=n.file2,n.file2=i}},patch:function(e,t){function n(t){for(;t>r;)i.push(e[r]),r++}for(var i=[],r=0,o=0;o<t.length;o++){var s=t[o];n(s.file1.offset);for(var a=0;a<s.file2.chunk.length;a++)i.push(s.file2.chunk[a]);r+=s.file1.length}return n(e.length),i},diff_indices:function(e,t){for(var n=[],i=e.length,r=t.length,o=Diff.longest_common_subsequence(e,t);null!==o;o=o.chain){var s=i-o.file1index-1,a=r-o.file2index-1;i=o.file1index,r=o.file2index,(s||a)&&n.push({file1:[i+1,s],file2:[r+1,a]})}return n.reverse(),n},diff3_merge_indices:function(e,t,n){function i(e,t){l.push([e.file1[0],t,e.file1[1],e.file2[0],e.file2[1]])}function r(e){e>u&&(c.push([1,u,e-u]),u=e)}var o,s=Diff.diff_indices(t,e),a=Diff.diff_indices(t,n),l=[];for(o=0;o<s.length;o++)i(s[o],0);for(o=0;o<a.length;o++)i(a[o],2);l.sort();for(var c=[],u=0,f=0;f<l.length;f++){for(var h=f,p=l[f],g=p[0],d=g+p[2];f<l.length-1;){var m=l[f+1],v=m[0];if(v>d)break;d=Math.max(d,v+m[2]),f++}if(r(g),h==f)p[4]>0&&c.push([p[1],p[3],p[4]]);else{var b={0:[e.length,-1,t.length,-1],2:[n.length,-1,t.length,-1]};for(o=h;f>=o;o++){p=l[o];var y=p[1],_=b[y],S=p[0],j=S+p[2],M=p[3],x=M+p[4];_[0]=Math.min(M,_[0]),_[1]=Math.max(x,_[1]),_[2]=Math.min(S,_[2]),_[3]=Math.max(j,_[3])}var O=b[0][0]+(g-b[0][2]),w=b[0][1]+(d-b[0][3]),R=b[2][0]+(g-b[2][2]),D=b[2][1]+(d-b[2][3]);c.push([-1,O,w-O,g,d-g,R,D-R])}u=d}return r(t.length),c},diff3_merge:function(e,t,n,i){function r(){u.length&&a.push({ok:u}),u=[]}function o(e){for(var t=0;t<e.length;t++)u.push(e[t])}function s(t){if(t[2]!=t[6])return!0;for(var i=t[1],r=t[5],o=0;o<t[2];o++)if(e[o+i]!=n[o+r])return!0;return!1}for(var a=[],l=[e,t,n],c=Diff.diff3_merge_indices(e,t,n),u=[],f=0;f<c.length;f++){var h=c[f],p=h[0];-1==p?i&&!s(h)?o(l[0].slice(h[1],h[1]+h[2])):(r(),a.push({conflict:{a:e.slice(h[1],h[1]+h[2]),aIndex:h[1],o:t.slice(h[3],h[3]+h[4]),oIndex:h[3],b:n.slice(h[5],h[5]+h[6]),bIndex:h[5]}})):o(l[p].slice(h[1],h[1]+h[2]))}return r(),a}};!function(){function e(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}e.prototype.diff_main=function(e,t,n,i){if("undefined"==typeof i&&(i=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout),null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[[0,e]]:[];"undefined"==typeof n&&(n=!0);var r=n,o=this.diff_commonPrefix(e,t);n=e.substring(0,o),e=e.substring(o),t=t.substring(o);var o=this.diff_commonSuffix(e,t),s=e.substring(e.length-o);return e=e.substring(0,e.length-o),t=t.substring(0,t.length-o),e=this.diff_compute_(e,t,r,i),n&&e.unshift([0,n]),s&&e.push([0,s]),this.diff_cleanupMerge(e),e},e.prototype.diff_compute_=function(e,t,n,i){if(!e)return[[1,t]];if(!t)return[[-1,e]];var r=e.length>t.length?e:t,o=e.length>t.length?t:e,s=r.indexOf(o);return-1!=s?(n=[[1,r.substring(0,s)],[0,o],[1,r.substring(s+o.length)]],e.length>t.length&&(n[0][0]=n[2][0]=-1),n):1==o.length?[[-1,e],[1,t]]:(r=this.diff_halfMatch_(e,t))?(o=r[0],e=r[1],s=r[2],t=r[3],r=r[4],o=this.diff_main(o,s,n,i),n=this.diff_main(e,t,n,i),o.concat([[0,r]],n)):n&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},e.prototype.diff_lineMode_=function(e,t,n){var i=this.diff_linesToChars_(e,t);e=i.chars1,t=i.chars2,i=i.lineArray,e=this.diff_main(e,t,!1,n),this.diff_charsToLines_(e,i),this.diff_cleanupSemantic(e),e.push([0,""]);for(var r=i=t=0,o="",s="";t<e.length;){switch(e[t][0]){case 1:r++,s+=e[t][1];break;case-1:i++,o+=e[t][1];break;case 0:if(i>=1&&r>=1){for(e.splice(t-i-r,i+r),t=t-i-r,i=this.diff_main(o,s,!1,n),r=i.length-1;r>=0;r--)e.splice(t,0,i[r]);t+=i.length}i=r=0,s=o=""}t++}return e.pop(),e},e.prototype.diff_bisect_=function(e,t,n){for(var i=e.length,r=t.length,o=Math.ceil((i+r)/2),s=o,a=2*o,l=Array(a),c=Array(a),u=0;a>u;u++)l[u]=-1,c[u]=-1;l[s+1]=0,c[s+1]=0;for(var u=i-r,f=0!=u%2,h=0,p=0,g=0,d=0,m=0;o>m&&!((new Date).getTime()>n);m++){for(var v=-m+h;m-p>=v;v+=2){var b,y=s+v;b=v==-m||v!=m&&l[y-1]<l[y+1]?l[y+1]:l[y-1]+1;for(var _=b-v;i>b&&r>_&&e.charAt(b)==t.charAt(_);)b++,_++;if(l[y]=b,b>i)p+=2;else if(_>r)h+=2;else if(f&&(y=s+u-v,y>=0&&a>y&&-1!=c[y])){var S=i-c[y];if(b>=S)return this.diff_bisectSplit_(e,t,b,_,n)}}for(v=-m+g;m-d>=v;v+=2){for(y=s+v,S=v==-m||v!=m&&c[y-1]<c[y+1]?c[y+1]:c[y-1]+1,b=S-v;i>S&&r>b&&e.charAt(i-S-1)==t.charAt(r-b-1);)S++,b++;if(c[y]=S,S>i)d+=2;else if(b>r)g+=2;else if(!f&&(y=s+u-v,y>=0&&a>y&&-1!=l[y]&&(b=l[y],_=s+b-y,S=i-S,b>=S)))return this.diff_bisectSplit_(e,t,b,_,n)}}return[[-1,e],[1,t]]},e.prototype.diff_bisectSplit_=function(e,t,n,i,r){var o=e.substring(0,n),s=t.substring(0,i);return e=e.substring(n),t=t.substring(i),o=this.diff_main(o,s,!1,r),r=this.diff_main(e,t,!1,r),o.concat(r)},e.prototype.diff_linesToChars_=function(e,t){function n(e){for(var t="",n=0,o=-1,s=i.length;o<e.length-1;){o=e.indexOf("\n",n),-1==o&&(o=e.length-1);var a=e.substring(n,o+1),n=o+1;(r.hasOwnProperty?r.hasOwnProperty(a):void 0!==r[a])?t+=String.fromCharCode(r[a]):(t+=String.fromCharCode(s),r[a]=s,i[s++]=a)}return t}var i=[],r={};i[0]="";var o=n(e),s=n(t);return{chars1:o,chars2:s,lineArray:i}},e.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],r=[],o=0;o<i.length;o++)r[o]=t[i.charCodeAt(o)];e[n][1]=r.join("")}},e.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),r=i,o=0;r>n;)e.substring(o,r)==t.substring(o,r)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r},e.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),r=i,o=0;r>n;)e.substring(e.length-r,e.length-o)==t.substring(t.length-r,t.length-o)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r},e.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;if(n>i?e=e.substring(n-i):i>n&&(t=t.substring(0,n)),n=Math.min(n,i),e==t)return n;for(var i=0,r=1;;){var o=e.substring(n-r),o=t.indexOf(o);if(-1==o)return i;r+=o,(0==o||e.substring(n-r)==t.substring(0,r))&&(i=r,r++)}},e.prototype.diff_halfMatch_=function(e,t){function n(e,t,n){for(var i,r,o,a,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,u="";-1!=(c=t.indexOf(l,c+1));){var f=s.diff_commonPrefix(e.substring(n),t.substring(c)),h=s.diff_commonSuffix(e.substring(0,n),t.substring(0,c));u.length<h+f&&(u=t.substring(c-h,c)+t.substring(c,c+f),i=e.substring(0,n-h),r=e.substring(n+f),o=t.substring(0,c-h),a=t.substring(c+f))}return 2*u.length>=e.length?[i,r,o,a,u]:null}if(0>=this.Diff_Timeout)return null;var i=e.length>t.length?e:t,r=e.length>t.length?t:e;if(4>i.length||2*r.length<i.length)return null;var o,s=this,a=n(i,r,Math.ceil(i.length/4)),i=n(i,r,Math.ceil(i.length/2));if(!a&&!i)return null;o=i?a&&a[4].length>i[4].length?a:i:a;var l;return e.length>t.length?(a=o[0],i=o[1],r=o[2],l=o[3]):(r=o[0],l=o[1],a=o[2],i=o[3]),o=o[4],[a,i,r,l,o]},e.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,r=null,o=0,s=0,a=0,l=0,c=0;o<e.length;)0==e[o][0]?(n[i++]=o,s=l,a=c,c=l=0,r=e[o][1]):(1==e[o][0]?l+=e[o][1].length:c+=e[o][1].length,r&&r.length<=Math.max(s,a)&&r.length<=Math.max(l,c)&&(e.splice(n[i-1],0,[-1,r]),e[n[i-1]+1][0]=1,i--,i--,o=i>0?n[i-1]:-1,c=l=a=s=0,r=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;)-1==e[o-1][0]&&1==e[o][0]&&(t=e[o-1][1],n=e[o][1],i=this.diff_commonOverlap_(t,n),r=this.diff_commonOverlap_(n,t),i>=r?(i>=t.length/2||i>=n.length/2)&&(e.splice(o,0,[0,n.substring(0,i)]),e[o-1][1]=t.substring(0,t.length-i),e[o+1][1]=n.substring(i),o++):(r>=t.length/2||r>=n.length/2)&&(e.splice(o,0,[0,t.substring(0,r)]),e[o-1][0]=1,e[o-1][1]=n.substring(0,n.length-r),e[o+1][0]=-1,e[o+1][1]=t.substring(r),o++),o++),o++},e.prototype.diff_cleanupSemanticLossless=function(t){function n(t,n){if(!t||!n)return 6;var i=t.charAt(t.length-1),r=n.charAt(0),o=i.match(e.nonAlphaNumericRegex_),s=r.match(e.nonAlphaNumericRegex_),a=o&&i.match(e.whitespaceRegex_),l=s&&r.match(e.whitespaceRegex_),i=a&&i.match(e.linebreakRegex_),r=l&&r.match(e.linebreakRegex_),c=i&&t.match(e.blanklineEndRegex_),u=r&&n.match(e.blanklineStartRegex_);
return c||u?5:i||r?4:o&&!a&&l?3:a||l?2:o||s?1:0}for(var i=1;i<t.length-1;){if(0==t[i-1][0]&&0==t[i+1][0]){var r=t[i-1][1],o=t[i][1],s=t[i+1][1],a=this.diff_commonSuffix(r,o);if(a)var l=o.substring(o.length-a),r=r.substring(0,r.length-a),o=l+o.substring(0,o.length-a),s=l+s;for(var a=r,l=o,c=s,u=n(r,o)+n(o,s);o.charAt(0)===s.charAt(0);){var r=r+o.charAt(0),o=o.substring(1)+s.charAt(0),s=s.substring(1),f=n(r,o)+n(o,s);f>=u&&(u=f,a=r,l=o,c=s)}t[i-1][1]!=a&&(a?t[i-1][1]=a:(t.splice(i-1,1),i--),t[i][1]=l,c?t[i+1][1]=c:(t.splice(i+1,1),i--))}i++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],i=0,r=null,o=0,s=!1,a=!1,l=!1,c=!1;o<e.length;)0==e[o][0]?(e[o][1].length<this.Diff_EditCost&&(l||c)?(n[i++]=o,s=l,a=c,r=e[o][1]):(i=0,r=null),l=c=!1):(-1==e[o][0]?c=!0:l=!0,r&&(s&&a&&l&&c||r.length<this.Diff_EditCost/2&&3==s+a+l+c)&&(e.splice(n[i-1],0,[-1,r]),e[n[i-1]+1][0]=1,i--,r=null,s&&a?(l=c=!0,i=0):(i--,o=i>0?n[i-1]:-1,l=c=!1),t=!0)),o++;t&&this.diff_cleanupMerge(e)},e.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,n=0,i=0,r=0,o="",s="";n<e.length;)switch(e[n][0]){case 1:r++,s+=e[n][1],n++;break;case-1:i++,o+=e[n][1],n++;break;case 0:i+r>1?(0!==i&&0!==r&&(t=this.diff_commonPrefix(s,o),0!==t&&(n-i-r>0&&0==e[n-i-r-1][0]?e[n-i-r-1][1]+=s.substring(0,t):(e.splice(0,0,[0,s.substring(0,t)]),n++),s=s.substring(t),o=o.substring(t)),t=this.diff_commonSuffix(s,o),0!==t&&(e[n][1]=s.substring(s.length-t)+e[n][1],s=s.substring(0,s.length-t),o=o.substring(0,o.length-t))),0===i?e.splice(n-r,i+r,[1,s]):0===r?e.splice(n-i,i+r,[-1,o]):e.splice(n-i-r,i+r,[-1,o],[1,s]),n=n-i-r+(i?1:0)+(r?1:0)+1):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,i=r=0,s=o=""}for(""===e[e.length-1][1]&&e.pop(),i=!1,n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),i=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),i=!0)),n++;i&&this.diff_cleanupMerge(e)},e.prototype.diff_xIndex=function(e,t){var n,i=0,r=0,o=0,s=0;for(n=0;n<e.length&&(1!==e[n][0]&&(i+=e[n][1].length),-1!==e[n][0]&&(r+=e[n][1].length),!(i>t));n++)o=i,s=r;return e.length!=n&&-1===e[n][0]?s:s+(t-o)},e.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,r=/>/g,o=/\n/g,s=0;s<e.length;s++){var a=e[s][0],l=e[s][1],l=l.replace(n,"&amp;").replace(i,"&lt;").replace(r,"&gt;").replace(o,"&para;<br>");switch(a){case 1:t[s]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case-1:t[s]='<del style="background:#ffe6e6;">'+l+"</del>";break;case 0:t[s]="<span>"+l+"</span>"}}return t.join("")},e.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},e.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},e.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,r=0;r<e.length;r++){var o=e[r][0],s=e[r][1];switch(o){case 1:n+=s.length;break;case-1:i+=s.length;break;case 0:t+=Math.max(n,i),i=n=0}}return t+=Math.max(n,i)},e.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case-1:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(e,t){for(var n=[],i=0,r=0,o=t.split(/\t/g),s=0;s<o.length;s++){var a=o[s].substring(1);switch(o[s].charAt(0)){case"+":try{n[i++]=[1,decodeURI(a)]}catch(l){throw Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var c=parseInt(a,10);if(isNaN(c)||0>c)throw Error("Invalid number in diff_fromDelta: "+a);a=e.substring(r,r+=c),"="==o[s].charAt(0)?n[i++]=[0,a]:n[i++]=[-1,a];break;default:if(o[s])throw Error("Invalid diff operation in diff_fromDelta: "+o[s])}}if(r!=e.length)throw Error("Delta length ("+r+") does not equal source text length ("+e.length+").");return n},e.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},e.prototype.match_bitap_=function(e,t,n){function i(e,i){var r=e/t.length,s=Math.abs(n-i);return o.Match_Distance?r+s/o.Match_Distance:s?1:r}if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var r=this.match_alphabet_(t),o=this,s=this.Match_Threshold,a=e.indexOf(t,n);-1!=a&&(s=Math.min(i(0,a),s),a=e.lastIndexOf(t,n+t.length),-1!=a&&(s=Math.min(i(0,a),s)));for(var l,c,u,f=1<<t.length-1,a=-1,h=t.length+e.length,p=0;p<t.length;p++){for(l=0,c=h;c>l;)i(p,n+c)<=s?l=c:h=c,c=Math.floor((h-l)/2+l);h=c,l=Math.max(1,n-c+1);var g=Math.min(n+c,e.length)+t.length;for(c=Array(g+2),c[g+1]=(1<<p)-1;g>=l;g--){var d=r[e.charAt(g-1)];if(c[g]=0===p?(c[g+1]<<1|1)&d:(c[g+1]<<1|1)&d|((u[g+1]|u[g])<<1|1)|u[g+1],c[g]&f&&(d=i(p,g-1),s>=d)){if(s=d,a=g-1,!(a>n))break;l=Math.max(1,2*n-a)}}if(i(p+1,n)>s)break;u=c}return a},e.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},e.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),i=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=t.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin,(n=t.substring(e.start2-i,e.start2))&&e.diffs.unshift([0,n]),(i=t.substring(e.start2+e.length1,e.start2+e.length1+i))&&e.diffs.push([0,i]),e.start1-=n.length,e.start2-=n.length,e.length1+=n.length+i.length,e.length2+=n.length+i.length}},e.prototype.patch_make=function(t,n,i){var r;if("string"==typeof t&&"string"==typeof n&&"undefined"==typeof i)r=t,n=this.diff_main(r,n,!0),2<n.length&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(t&&"object"==typeof t&&"undefined"==typeof n&&"undefined"==typeof i)n=t,r=this.diff_text1(n);else if("string"==typeof t&&n&&"object"==typeof n&&"undefined"==typeof i)r=t;else{if("string"!=typeof t||"string"!=typeof n||!i||"object"!=typeof i)throw Error("Unknown call format to patch_make.");r=t,n=i}if(0===n.length)return[];i=[],t=new e.patch_obj;for(var o=0,s=0,a=0,l=r,c=0;c<n.length;c++){var u=n[c][0],f=n[c][1];switch(!o&&0!==u&&(t.start1=s,t.start2=a),u){case 1:t.diffs[o++]=n[c],t.length2+=f.length,r=r.substring(0,a)+f+r.substring(a);break;case-1:t.length1+=f.length,t.diffs[o++]=n[c],r=r.substring(0,a)+r.substring(a+f.length);break;case 0:f.length<=2*this.Patch_Margin&&o&&n.length!=c+1?(t.diffs[o++]=n[c],t.length1+=f.length,t.length2+=f.length):f.length>=2*this.Patch_Margin&&o&&(this.patch_addContext_(t,l),i.push(t),t=new e.patch_obj,o=0,l=r,s=a)}1!==u&&(s+=f.length),-1!==u&&(a+=f.length)}return o&&(this.patch_addContext_(t,l),i.push(t)),i},e.prototype.patch_deepCopy=function(t){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=new e.patch_obj;o.diffs=[];for(var s=0;s<r.diffs.length;s++)o.diffs[s]=r.diffs[s].slice();o.start1=r.start1,o.start2=r.start2,o.length1=r.length1,o.length2=r.length2,n[i]=o}return n},e.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,r=[],o=0;o<e.length;o++){var s,a=e[o].start2+i,l=this.diff_text1(e[o].diffs),c=-1;if(l.length>this.Match_MaxBits?(s=this.match_main(t,l.substring(0,this.Match_MaxBits),a),-1!=s&&(c=this.match_main(t,l.substring(l.length-this.Match_MaxBits),a+l.length-this.Match_MaxBits),-1==c||s>=c)&&(s=-1)):s=this.match_main(t,l,a),-1==s)r[o]=!1,i-=e[o].length2-e[o].length1;else if(r[o]=!0,i=s-a,a=-1==c?t.substring(s,s+l.length):t.substring(s,c+this.Match_MaxBits),l==a)t=t.substring(0,s)+this.diff_text2(e[o].diffs)+t.substring(s+l.length);else if(a=this.diff_main(l,a,!1),l.length>this.Match_MaxBits&&this.diff_levenshtein(a)/l.length>this.Patch_DeleteThreshold)r[o]=!1;else{this.diff_cleanupSemanticLossless(a);for(var u,l=0,c=0;c<e[o].diffs.length;c++){var f=e[o].diffs[c];0!==f[0]&&(u=this.diff_xIndex(a,l)),1===f[0]?t=t.substring(0,s+u)+f[1]+t.substring(s+u):-1===f[0]&&(t=t.substring(0,s+u)+t.substring(s+this.diff_xIndex(a,l+f[1].length))),-1!==f[0]&&(l+=f[1].length)}}}return t=t.substring(n.length,t.length-n.length),[t,r]},e.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",i=1;t>=i;i++)n+=String.fromCharCode(i);for(i=0;i<e.length;i++)e[i].start1+=t,e[i].start2+=t;var i=e[0],r=i.diffs;if(0==r.length||0!=r[0][0])r.unshift([0,n]),i.start1-=t,i.start2-=t,i.length1+=t,i.length2+=t;else if(t>r[0][1].length){var o=t-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],i.start1-=o,i.start2-=o,i.length1+=o,i.length2+=o}return i=e[e.length-1],r=i.diffs,0==r.length||0!=r[r.length-1][0]?(r.push([0,n]),i.length1+=t,i.length2+=t):t>r[r.length-1][1].length&&(o=t-r[r.length-1][1].length,r[r.length-1][1]+=n.substring(0,o),i.length1+=o,i.length2+=o),n},e.prototype.patch_splitMax=function(t){for(var n=this.Match_MaxBits,i=0;i<t.length;i++)if(!(t[i].length1<=n)){var r=t[i];t.splice(i--,1);for(var o=r.start1,s=r.start2,a="";0!==r.diffs.length;){var l=new e.patch_obj,c=!0;for(l.start1=o-a.length,l.start2=s-a.length,""!==a&&(l.length1=l.length2=a.length,l.diffs.push([0,a]));0!==r.diffs.length&&l.length1<n-this.Patch_Margin;){var a=r.diffs[0][0],u=r.diffs[0][1];1===a?(l.length2+=u.length,s+=u.length,l.diffs.push(r.diffs.shift()),c=!1):-1===a&&1==l.diffs.length&&0==l.diffs[0][0]&&u.length>2*n?(l.length1+=u.length,o+=u.length,c=!1,l.diffs.push([a,u]),r.diffs.shift()):(u=u.substring(0,n-l.length1-this.Patch_Margin),l.length1+=u.length,o+=u.length,0===a?(l.length2+=u.length,s+=u.length):c=!1,l.diffs.push([a,u]),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}a=this.diff_text2(l.diffs),a=a.substring(a.length-this.Patch_Margin),u=this.diff_text1(r.diffs).substring(0,this.Patch_Margin),""!==u&&(l.length1+=u.length,l.length2+=u.length,0!==l.diffs.length&&0===l.diffs[l.diffs.length-1][0]?l.diffs[l.diffs.length-1][1]+=u:l.diffs.push([0,u])),c||t.splice(++i,0,l)}}},e.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},e.prototype.patch_fromText=function(t){var n=[];if(!t)return n;t=t.split("\n");for(var i=0,r=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;i<t.length;){var o=t[i].match(r);if(!o)throw Error("Invalid patch string: "+t[i]);var s=new e.patch_obj;for(n.push(s),s.start1=parseInt(o[1],10),""===o[2]?(s.start1--,s.length1=1):"0"==o[2]?s.length1=0:(s.start1--,s.length1=parseInt(o[2],10)),s.start2=parseInt(o[3],10),""===o[4]?(s.start2--,s.length2=1):"0"==o[4]?s.length2=0:(s.start2--,s.length2=parseInt(o[4],10)),i++;i<t.length;){o=t[i].charAt(0);try{var a=decodeURI(t[i].substring(1))}catch(l){throw Error("Illegal escape in patch_fromText: "+a)}if("-"==o)s.diffs.push([-1,a]);else if("+"==o)s.diffs.push([1,a]);else if(" "==o)s.diffs.push([0,a]);else{if("@"==o)break;if(""!==o)throw Error('Invalid patch mode "'+o+'" in: '+a)}i++}}return n},e.patch_obj=function(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0},e.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,e=["@@ -"+e+" +"+t+" @@\n"];var n;for(t=0;t<this.diffs.length;t++){switch(this.diffs[t][0]){case 1:n="+";break;case-1:n="-";break;case 0:n=" "}e[t+1]=n+encodeURI(this.diffs[t][1])+"\n"}return e.join("").replace(/%20/g," ")},this.diff_match_patch=e,this.DIFF_DELETE=-1,this.DIFF_INSERT=1,this.DIFF_EQUAL=0}();var fs=require("fs"),express=require("express"),app=express(),server;app.use(express["static"](__dirname+"/jasmine-standalone-2.0.0")),app.get("/ServerDate.js",function(e,t){fs.readFile(__dirname+"/../lib/ServerDate.js","utf8",function(n,i){var r=Date.now();n?t.status(500):e.query.time?(t.set("Content-Type","application/json"),t.json(r)):(t.set("Content-Type","text/javascript"),t.send(i+"("+r+");\n"))})}),server=app.listen(),console.log("Open http://localhost:"+server.address().port+" in a browser."),describe("ServerDate",function(){describe("constructor",function(){it("returns a string when called without new",function(){expect(typeof ServerDate()).toBe("string")}),it("returns itself when called with new",function(){expect(new ServerDate).toBe(ServerDate)}),it("parse is the same as Date.parse",function(){expect(ServerDate.parse).toBe(Date.parse)}),it("UTC is the same as Date.UTC",function(){expect(ServerDate.UTC).toBe(Date.UTC)}),it("now returns a number",function(){expect(typeof ServerDate.now()).toBe("number")})}),describe("immutable methods return the same type as their Date counterparts",function(){var e;e=new Date,["toString","toDateString","toTimeString","toLocaleString","toLocaleDateString","toLocaleTimeString","valueOf","getTime","getFullYear","getUTCFullYear","getMonth","getUTCMonth","getDate","getUTCDate","getDay","getUTCDay","getHours","getUTCHours","getMinutes","getUTCMinutes","getSeconds","getUTCSeconds","getMilliseconds","getUTCMilliseconds","getTimezoneOffset","toUTCString","toISOString","toJSON"].forEach(function(t){it(t,function(){expect(typeof ServerDate[t]()).toBe(typeof e[t]())})})}),describe("mutable Date methods are undefined",function(){["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"].forEach(function(e){it(e,function(){expect(ServerDate[e]).toBe(void 0)})})}),describe("additional properties not found in Date",function(){it("getPrecision returns a number",function(){expect(typeof ServerDate.getPrecision()).toBe("number")}),it("amortizationRate default is 25 ms",function(){expect(ServerDate.amortizationRate).toBe(25)}),it("amortizationThreshold default is 2000 ms",function(){expect(ServerDate.amortizationThreshold).toBe(2e3)}),it("synchronizationIntervalDelay default is 1 hour",function(){expect(ServerDate.synchronizationIntervalDelay).toBe(36e5)})})}),function(){function e(e,t){for(var n in t)e[n]=t[n];return e}window.jasmine=jasmineRequire.core(jasmineRequire),jasmineRequire.html(jasmine);var t=jasmine.getEnv(),n={describe:function(e,n){return t.describe(e,n)},xdescribe:function(e,n){return t.xdescribe(e,n)},it:function(e,n){return t.it(e,n)},xit:function(e,n){return t.xit(e,n)},beforeEach:function(e){return t.beforeEach(e)},afterEach:function(e){return t.afterEach(e)},expect:function(e){return t.expect(e)},pending:function(){return t.pending()},spyOn:function(e,n){return t.spyOn(e,n)},jsApiReporter:new jasmine.JsApiReporter({timer:new jasmine.Timer})};"undefined"==typeof window&&"object"==typeof exports?e(exports,n):e(window,n),jasmine.addCustomEqualityTester=function(e){t.addCustomEqualityTester(e)},jasmine.addMatchers=function(e){return t.addMatchers(e)},jasmine.clock=function(){return t.clock};var i=new jasmine.QueryString({getWindowLocation:function(){return window.location}}),r=i.getParam("catch");t.catchExceptions("undefined"==typeof r?!0:r);var o=new jasmine.HtmlReporter({env:t,onRaiseExceptionsClick:function(){i.setParam("catch",!t.catchingExceptions())},getContainer:function(){return document.body},createElement:function(){return document.createElement.apply(document,arguments)},createTextNode:function(){return document.createTextNode.apply(document,arguments)},timer:new jasmine.Timer});t.addReporter(n.jsApiReporter),t.addReporter(o);var s=new jasmine.HtmlSpecFilter({filterString:function(){return i.getParam("spec")}});t.specFilter=function(e){return s.matches(e.getFullName())},window.setTimeout=window.setTimeout,window.setInterval=window.setInterval,window.clearTimeout=window.clearTimeout,window.clearInterval=window.clearInterval;var a=window.onload;window.onload=function(){a&&a(),o.initialize(),t.execute()}}(),getJasmineRequireObj().console=function(e,t){t.ConsoleReporter=e.ConsoleReporter()},getJasmineRequireObj().ConsoleReporter=function(){function e(e){function n(){f("\n")}function i(e,t){return h?m[e]+t+m.none:t}function r(e,t){return 1==t?e:e+"s"}function o(e,t){for(var n=[],i=0;t>i;i++)n.push(e);return n}function s(e,t){for(var n=(e||"").split("\n"),i=[],r=0;r<n.length;r++)i.push(o(" ",t).join("")+n[r]);return i.join("\n")}function a(e){n(),f(e.fullName);for(var t=0;t<e.failedExpectations.length;t++){var i=e.failedExpectations[t];n(),f(s(i.stack,2))}n()}var l,c,u,f=e.print,h=e.showColors||!1,p=e.onComplete||function(){},g=e.timer||t,d=[],m={green:"[32m",red:"[31m",yellow:"[33m",none:"[0m"};return this.jasmineStarted=function(){l=0,c=0,u=0,f("Started"),n(),g.start()},this.jasmineDone=function(){n();for(var e=0;e<d.length;e++)a(d[e]);n();var t=l+" "+r("spec",l)+", "+c+" "+r("failure",c);u&&(t+=", "+u+" pending "+r("spec",u)),f(t),n();var i=g.elapsed()/1e3;f("Finished in "+i+" "+r("second",i)),n(),p(0===c)},this.specDone=function(e){return l++,"pending"==e.status?(u++,void f(i("yellow","*"))):"passed"==e.status?void f(i("green",".")):void("failed"==e.status&&(c++,d.push(e),f(i("red","F"))))},this}var t={start:function(){},elapsed:function(){return 0}};return e},jasmineRequire.html=function(e){e.ResultsNode=jasmineRequire.ResultsNode(),e.HtmlReporter=jasmineRequire.HtmlReporter(e),e.QueryString=jasmineRequire.QueryString(),e.HtmlSpecFilter=jasmineRequire.HtmlSpecFilter()},jasmineRequire.HtmlReporter=function(e){function t(t){function i(e){return f().querySelector(e)}function r(e,t,n){for(var i=h(e),r=2;r<arguments.length;r++){var o=arguments[r];"string"==typeof o?i.appendChild(p(o)):o&&i.appendChild(o)}for(var s in t)"className"==s?i[s]=t[s]:i.setAttribute(s,t[s]);return i}function o(e,t){var n=1==t?e:e+"s";return""+t+" "+n}function s(e){return"?spec="+encodeURIComponent(e.fullName)}function a(e){l.setAttribute("class","html-reporter "+e)}var l,c,u=t.env||{},f=t.getContainer,h=t.createElement,p=t.createTextNode,g=t.onRaiseExceptionsClick||function(){},d=t.timer||n,m=0,v=0,b=0;this.initialize=function(){l=r("div",{className:"html-reporter"},r("div",{className:"banner"},r("span",{className:"title"},"Jasmine"),r("span",{className:"version"},e.version)),r("ul",{className:"symbol-summary"}),r("div",{className:"alert"}),r("div",{className:"results"},r("div",{className:"failures"}))),f().appendChild(l),c=i(".symbol-summary")};var y;this.jasmineStarted=function(e){y=e.totalSpecsDefined||0,d.start()};var _=r("div",{className:"summary"}),S=new e.ResultsNode({},"",null),j=S;this.suiteStarted=function(e){j.addChild(e,"suite"),j=j.last()},this.suiteDone=function(e){j!=S&&(j=j.parent)},this.specStarted=function(e){j.addChild(e,"spec")};var M=[];return this.specDone=function(e){if("disabled"!=e.status&&m++,c.appendChild(r("li",{className:e.status,id:"spec_"+e.id,title:e.fullName})),"failed"==e.status){v++;for(var t=r("div",{className:"spec-detail failed"},r("div",{className:"description"},r("a",{title:e.fullName,href:s(e)},e.fullName)),r("div",{className:"messages"})),n=t.childNodes[1],i=0;i<e.failedExpectations.length;i++){var o=e.failedExpectations[i];n.appendChild(r("div",{className:"result-message"},o.message)),n.appendChild(r("div",{className:"stack-trace"},o.stack))}M.push(t)}"pending"==e.status&&b++},this.jasmineDone=function(){function e(t,n){for(var i,o=0;o<t.children.length;o++){var a=t.children[o];if("suite"==a.type){var l=r("ul",{className:"suite",id:"suite-"+a.result.id},r("li",{className:"suite-detail"},r("a",{href:s(a.result)},a.result.description)));e(a,l),n.appendChild(l)}"spec"==a.type&&("specs"!=n.getAttribute("class")&&(i=r("ul",{className:"specs"}),n.appendChild(i)),i.appendChild(r("li",{className:a.result.status,id:"spec-"+a.result.id},r("a",{href:s(a.result)},a.result.description))))}}var t=i(".banner");t.appendChild(r("span",{className:"duration"},"finished in "+d.elapsed()/1e3+"s"));var n=i(".alert");n.appendChild(r("span",{className:"exceptions"},r("label",{className:"label","for":"raise-exceptions"},"raise exceptions"),r("input",{className:"raise",id:"raise-exceptions",type:"checkbox"})));var l=i("input");if(l.checked=!u.catchingExceptions(),l.onclick=g,y>m){var c="Ran "+m+" of "+y+" specs - run all";n.appendChild(r("span",{className:"bar skipped"},r("a",{href:"?",title:"Run all specs"},c)))}var f=""+o("spec",m)+", "+o("failure",v);b&&(f+=", "+o("pending spec",b));var h="bar "+(v>0?"failed":"passed");n.appendChild(r("span",{className:h},f));var p=i(".results");if(p.appendChild(_),e(S,_),M.length){n.appendChild(r("span",{className:"menu bar spec-list"},r("span",{},"Spec List | "),r("a",{className:"failures-menu",href:"#"},"Failures"))),n.appendChild(r("span",{className:"menu bar failure-list"},r("a",{className:"spec-list-menu",href:"#"},"Spec List"),r("span",{}," | Failures "))),i(".failures-menu").onclick=function(){a("failure-list")},i(".spec-list-menu").onclick=function(){a("spec-list")},a("failure-list");for(var j=i(".failures"),x=0;x<M.length;x++)j.appendChild(M[x])}},this}var n={start:function(){},elapsed:function(){return 0}};return t},jasmineRequire.HtmlSpecFilter=function(){function e(e){var t=e&&e.filterString()&&e.filterString().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),n=new RegExp(t);this.matches=function(e){return n.test(e)}}return e},jasmineRequire.ResultsNode=function(){function e(t,n,i){this.result=t,this.type=n,this.parent=i,this.children=[],this.addChild=function(t,n){this.children.push(new e(t,n,this))},this.last=function(){return this.children[this.children.length-1]}}return e},jasmineRequire.QueryString=function(){function e(e){function t(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return"?"+t.join("&")}function n(){var t=e.getWindowLocation().search.substring(1),n=[],i={};if(t.length>0){n=t.split("&");for(var r=0;r<n.length;r++){var o=n[r].split("="),s=decodeURIComponent(o[1]);("true"===s||"false"===s)&&(s=JSON.parse(s)),i[decodeURIComponent(o[0])]=s}}return i}return this.setParam=function(i,r){var o=n();o[i]=r,e.getWindowLocation().search=t(o)},this.getParam=function(e){return n()[e]},this}return e},getJasmineRequireObj().core=function(e){var t={};return e.base(t),t.util=e.util(),t.Any=e.Any(),t.CallTracker=e.CallTracker(),t.Clock=e.Clock(),t.DelayedFunctionScheduler=e.DelayedFunctionScheduler(),t.Env=e.Env(t),t.ExceptionFormatter=e.ExceptionFormatter(),t.Expectation=e.Expectation(),t.buildExpectationResult=e.buildExpectationResult(),t.JsApiReporter=e.JsApiReporter(),t.matchersUtil=e.matchersUtil(t),t.ObjectContaining=e.ObjectContaining(t),t.pp=e.pp(t),t.QueueRunner=e.QueueRunner(),t.ReportDispatcher=e.ReportDispatcher(),t.Spec=e.Spec(t),t.SpyStrategy=e.SpyStrategy(),t.Suite=e.Suite(),t.Timer=e.Timer(),t.version=e.version(),t.matchers=e.requireMatchers(e,t),t},getJasmineRequireObj().requireMatchers=function(e,t){for(var n=["toBe","toBeCloseTo","toBeDefined","toBeFalsy","toBeGreaterThan","toBeLessThan","toBeNaN","toBeNull","toBeTruthy","toBeUndefined","toContain","toEqual","toHaveBeenCalled","toHaveBeenCalledWith","toMatch","toThrow","toThrowError"],i={},r=0;r<n.length;r++){var o=n[r];i[o]=e[o](t)}return i},getJasmineRequireObj().base=function(e){e.unimplementedMethod_=function(){throw new Error("unimplemented method")},e.MAX_PRETTY_PRINT_DEPTH=40,e.DEFAULT_TIMEOUT_INTERVAL=5e3,e.getGlobal=function(){var e=eval.call(null,"this");return function(){return e}}(),e.getEnv=function(t){var n=e.currentEnv_=e.currentEnv_||new e.Env(t);return n},e.isArray_=function(t){return e.isA_("Array",t)},e.isString_=function(t){return e.isA_("String",t)},e.isNumber_=function(t){return e.isA_("Number",t)},e.isA_=function(e,t){return Object.prototype.toString.apply(t)==="[object "+e+"]"},e.isDomNode=function(e){return e.nodeType>0},e.any=function(t){return new e.Any(t)},e.objectContaining=function(t){return new e.ObjectContaining(t)},e.createSpy=function(t,n){var i=new e.SpyStrategy({name:t,fn:n,getSpy:function(){return o}}),r=new e.CallTracker,o=function(){return r.track({object:this,args:Array.prototype.slice.apply(arguments)}),i.exec.apply(this,arguments)};for(var s in n){if("and"===s||"calls"===s)throw new Error("Jasmine spies would overwrite the 'and' and 'calls' properties on the object being spied upon");o[s]=n[s]}return o.and=i,o.calls=r,o},e.isSpy=function(t){return t?t.and instanceof e.SpyStrategy&&t.calls instanceof e.CallTracker:!1},e.createSpyObj=function(t,n){if(!e.isArray_(n)||0===n.length)throw"createSpyObj requires a non-empty array of method names to create spies for";for(var i={},r=0;r<n.length;r++)i[n[r]]=e.createSpy(t+"."+n[r]);return i}},getJasmineRequireObj().util=function(){var e={};return e.inherit=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},e.htmlEscape=function(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},e.argsToArray=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},e.isUndefined=function(e){return void 0===e},e},getJasmineRequireObj().Spec=function(e){function t(e){this.expectationFactory=e.expectationFactory,this.resultCallback=e.resultCallback||function(){},this.id=e.id,this.description=e.description||"",this.fn=e.fn,this.beforeFns=e.beforeFns||function(){return[]},this.afterFns=e.afterFns||function(){return[]},this.onStart=e.onStart||function(){},this.exceptionFormatter=e.exceptionFormatter||function(){},this.getSpecName=e.getSpecName||function(){return""},this.expectationResultFactory=e.expectationResultFactory||function(){},this.queueRunnerFactory=e.queueRunnerFactory||function(){},this.catchingExceptions=e.catchingExceptions||function(){return!0},this.timer=e.timer||{setTimeout:setTimeout,clearTimeout:clearTimeout},this.fn||this.pend(),this.result={id:this.id,description:this.description,fullName:this.getFullName(),failedExpectations:[]}}return t.prototype.addExpectationResult=function(e,t){e||this.result.failedExpectations.push(this.expectationResultFactory(t))},t.prototype.expect=function(e){return this.expectationFactory(e,this)},t.prototype.execute=function(n){function i(t){return function(n){a=Function.prototype.apply.apply(l.timer.setTimeout,[e.getGlobal(),[function(){o(new Error("Timeout - Async callback was not invoked within timeout specified by jasmine.DEFAULT_TIMEOUT_INTERVAL.")),n()},e.DEFAULT_TIMEOUT_INTERVAL]]);var i=function(){r(),n()};t.call(this,i)}}function r(){Function.prototype.apply.apply(l.timer.clearTimeout,[e.getGlobal(),[a]]),a=void 0}function o(e){return r(),t.isPendingSpecException(e)?void l.pend():void l.addExpectationResult(!1,{matcherName:"",passed:!1,expected:"",actual:"",error:e})}function s(){l.result.status=l.status(),l.resultCallback(l.result),n&&n()}var a,l=this;if(this.onStart(this),this.markedPending||this.disabled)return void s();for(var c=this.beforeFns().concat(this.fn).concat(this.afterFns()),u=[],f=0;f<c.length;f++){var h=c[f];u.push(h.length>0?i(h):h)}this.queueRunnerFactory({fns:u,onException:o,onComplete:s})},t.prototype.disable=function(){this.disabled=!0},t.prototype.pend=function(){this.markedPending=!0},t.prototype.status=function(){return this.disabled?"disabled":this.markedPending?"pending":this.result.failedExpectations.length>0?"failed":"passed"},t.prototype.getFullName=function(){return this.getSpecName(this)},t.pendingSpecExceptionMessage="=> marked Pending",t.isPendingSpecException=function(e){return-1!==e.toString().indexOf(t.pendingSpecExceptionMessage)},t},void 0==typeof window&&"object"==typeof exports&&(exports.Spec=jasmineRequire.Spec),getJasmineRequireObj().Env=function(e){function t(t){function n(e){D++,D>=R?(D=0,a(e,0)):e()}t=t||{};var i=this,r=t.global||e.getGlobal(),o=0,s=!0,a=e.getGlobal().setTimeout,l=e.getGlobal().clearTimeout;this.clock=new e.Clock(r,new e.DelayedFunctionScheduler);var c={},u=[],f=null,h=null,p=new e.ReportDispatcher(["jasmineStarted","jasmineDone","suiteStarted","suiteDone","specStarted","specDone"]);this.specFilter=function(){return!0};var g=[];this.addCustomEqualityTester=function(e){g.push(e)},e.Expectation.addCoreMatchers(e.matchers);var d=0,m=function(){return"spec"+d++},v=0,b=function(){return"suite"+v++},y=function(t,n){function i(e,t){return n.addExpectationResult(e,t)}return e.Expectation.Factory({util:e.matchersUtil,customEqualityTesters:g,actual:t,addExpectationResult:i})},_=function(e){f=e,p.specStarted(e.result)},S=function(e){return function(){for(var t=[];e;)t=t.concat(e.beforeFns),e=e.parentSuite;return t.reverse()}},j=function(e){return function(){for(var t=[];e;)t=t.concat(e.afterFns),e=e.parentSuite;return t}},M=function(e,t){return t.getFullName()+" "+e.description},x=e.buildExpectationResult,O=new e.ExceptionFormatter,w=function(e){return e.messageFormatter=O.message,e.stackFormatter=O.stack,x(e)};this.catchExceptions=function(e){return s=!!e},this.catchingExceptions=function(){return s};var R=20,D=0,T=function(t){return e.Spec.isPendingSpecException(t)||s},E=function(t){t.catchException=T,t.clearStack=t.clearStack||n,new e.QueueRunner(t).execute()},F=new e.Suite({env:this,id:b(),description:"Jasmine__TopLevel__Suite",queueRunner:E,resultCallback:function(){}});c[F.id]=F,h=F,this.topSuite=function(){return F},this.execute=function(e){e=e||[F.id];for(var t=[],n=0;n<e.length;n++){var i=c[e[n]];t.push(function(e){return function(t){e.execute(t)}}(i))}p.jasmineStarted({totalSpecsDefined:o}),E({fns:t,onComplete:p.jasmineDone})},this.addReporter=function(e){p.addReporter(e)},this.addMatchers=function(t){e.Expectation.addMatchers(t)},this.spyOn=function(t,n){if(e.util.isUndefined(t))throw new Error("spyOn could not find an object to spy upon for "+n+"()");if(e.util.isUndefined(t[n]))throw new Error(n+"() method does not exist");if(t[n]&&e.isSpy(t[n]))throw new Error(n+" has already been spied upon");var i=e.createSpy(n,t[n]);return u.push({spy:i,baseObj:t,methodName:n,originalValue:t[n]}),t[n]=i,i};var C=function(t){var n=new e.Suite({env:i,id:b(),description:t,parentSuite:h,queueRunner:E,onStart:k,resultCallback:function(e){p.suiteDone(e)}});return c[n.id]=n,n};this.describe=function(e,t){var n=C(e),i=h;i.addChild(n),h=n;var r=null;try{t.call(n)}catch(o){r=o}return r&&this.it("encountered a declaration exception",function(){throw r}),h=i,n},this.xdescribe=function(e,t){var n=this.describe(e,t);return n.disable(),n};var I=function(t,n,r){function s(){for(var e=0;e<u.length;e++){var t=u[e];t.baseObj[t.methodName]=t.originalValue}u=[]}function h(t){s(),e.Expectation.resetMatchers(),g=[],f=null,p.specDone(t)}o++;var d=new e.Spec({id:m(),beforeFns:S(r),afterFns:j(r),expectationFactory:y,exceptionFormatter:O,resultCallback:h,getSpecName:function(e){return M(e,r)},onStart:_,description:t,expectationResultFactory:w,queueRunnerFactory:E,fn:n,timer:{setTimeout:a,clearTimeout:l}});return c[d.id]=d,i.specFilter(d)||d.disable(),d},k=function(e){p.suiteStarted(e.result)};this.it=function(e,t){var n=I(e,t,h);return h.addChild(n),n},this.xit=function(e,t){var n=this.it(e,t);return n.pend(),n},this.expect=function(e){return f.expect(e)},this.beforeEach=function(e){h.beforeEach(e)},this.afterEach=function(e){h.afterEach(e)},this.pending=function(){throw e.Spec.pendingSpecExceptionMessage}}return t},getJasmineRequireObj().JsApiReporter=function(){function e(e){function n(e){s[e.id]=e}var i=e.timer||t,r="loaded";this.started=!1,this.finished=!1,this.jasmineStarted=function(){this.started=!0,r="started",i.start()};var o;this.jasmineDone=function(){this.finished=!0,o=i.elapsed(),r="done"},this.status=function(){return r};var s={};this.suiteStarted=function(e){n(e)},this.suiteDone=function(e){n(e)},this.suites=function(){return s};var a=[];this.specStarted=function(e){},
this.specDone=function(e){a.push(e)},this.specResults=function(e,t){return a.slice(e,e+t)},this.specs=function(){return a},this.executionTime=function(){return o}}var t={start:function(){},elapsed:function(){return 0}};return e},getJasmineRequireObj().Any=function(){function e(e){this.expectedObject=e}return e.prototype.jasmineMatches=function(e){return this.expectedObject==String?"string"==typeof e||e instanceof String:this.expectedObject==Number?"number"==typeof e||e instanceof Number:this.expectedObject==Function?"function"==typeof e||e instanceof Function:this.expectedObject==Object?"object"==typeof e:this.expectedObject==Boolean?"boolean"==typeof e:e instanceof this.expectedObject},e.prototype.jasmineToString=function(){return"<jasmine.any("+this.expectedClass+")>"},e},getJasmineRequireObj().CallTracker=function(){function e(){var e=[];this.track=function(t){e.push(t)},this.any=function(){return!!e.length},this.count=function(){return e.length},this.argsFor=function(t){var n=e[t];return n?n.args:[]},this.all=function(){return e},this.allArgs=function(){for(var t=[],n=0;n<e.length;n++)t.push(e[n].args);return t},this.first=function(){return e[0]},this.mostRecent=function(){return e[e.length-1]},this.reset=function(){e=[]}}return e},getJasmineRequireObj().Clock=function(){function e(e,t){function n(){return!(f.setTimeout||f.setInterval).apply}function i(e,t){for(var n in t)e[n]=t[n]}function r(e,n){return t.scheduleFunction(e,n,l(arguments,2))}function o(e){return t.removeFunctionWithId(e)}function s(e,n){return t.scheduleFunction(e,n,l(arguments,2),!0)}function a(e){return t.removeFunctionWithId(e)}function l(e,t){return Array.prototype.slice.call(e,2)}var c,u=this,f={setTimeout:e.setTimeout,clearTimeout:e.clearTimeout,setInterval:e.setInterval,clearInterval:e.clearInterval},h={setTimeout:r,clearTimeout:o,setInterval:s,clearInterval:a},p=!1;return u.install=function(){i(e,h),c=h,p=!0},u.uninstall=function(){t.reset(),i(e,f),c=f,p=!1},u.setTimeout=function(t,i,r){if(n()){if(arguments.length>2)throw new Error("IE < 9 cannot support extra params to setTimeout without a polyfill");return c.setTimeout(t,i)}return Function.prototype.apply.apply(c.setTimeout,[e,arguments])},u.setInterval=function(t,i,r){if(n()){if(arguments.length>2)throw new Error("IE < 9 cannot support extra params to setInterval without a polyfill");return c.setInterval(t,i)}return Function.prototype.apply.apply(c.setInterval,[e,arguments])},u.clearTimeout=function(t){return Function.prototype.call.apply(c.clearTimeout,[e,t])},u.clearInterval=function(t){return Function.prototype.call.apply(c.clearInterval,[e,t])},u.tick=function(e){if(!p)throw new Error("Mock clock is not installed, use jasmine.clock().install()");t.tick(e)},u}return e},getJasmineRequireObj().DelayedFunctionScheduler=function(){function DelayedFunctionScheduler(){function indexOfFirstToPass(e,t){for(var n=-1,i=0;i<e.length;++i)if(t(e[i])){n=i;break}return n}function deleteFromLookup(e){var t=Number(e),n=indexOfFirstToPass(scheduledLookup,function(e){return e===t});n>-1&&scheduledLookup.splice(n,1)}function reschedule(e){self.scheduleFunction(e.funcToCall,e.millis,e.params,!0,e.timeoutKey,e.runAtMillis+e.millis)}function runScheduledFunctions(e){if(!(0===scheduledLookup.length||scheduledLookup[0]>e))do{currentTime=scheduledLookup.shift();var t=scheduledFunctions[currentTime];delete scheduledFunctions[currentTime];for(var n=0;n<t.length;++n){var i=t[n];i.funcToCall.apply(null,i.params||[]),i.recurring&&reschedule(i)}}while(scheduledLookup.length>0&&currentTime!==e&&scheduledLookup[0]<=e)}var self=this,scheduledLookup=[],scheduledFunctions={},currentTime=0,delayedFnCount=0;return self.tick=function(e){e=e||0;var t=currentTime+e;runScheduledFunctions(t),currentTime=t},self.scheduleFunction=function(funcToCall,millis,params,recurring,timeoutKey,runAtMillis){var f;f="string"==typeof funcToCall?function(){return eval(funcToCall)}:funcToCall,millis=millis||0,timeoutKey=timeoutKey||++delayedFnCount,runAtMillis=runAtMillis||currentTime+millis;var funcToSchedule={runAtMillis:runAtMillis,funcToCall:f,recurring:recurring,params:params,timeoutKey:timeoutKey,millis:millis};return runAtMillis in scheduledFunctions?scheduledFunctions[runAtMillis].push(funcToSchedule):(scheduledFunctions[runAtMillis]=[funcToSchedule],scheduledLookup.push(runAtMillis),scheduledLookup.sort(function(e,t){return e-t})),timeoutKey},self.removeFunctionWithId=function(e){for(var t in scheduledFunctions){var n=scheduledFunctions[t],i=indexOfFirstToPass(n,function(t){return t.timeoutKey===e});if(i>-1){1===n.length?(delete scheduledFunctions[t],deleteFromLookup(t)):n.splice(i,1);break}}},self.reset=function(){currentTime=0,scheduledLookup=[],scheduledFunctions={},delayedFnCount=0},self}return DelayedFunctionScheduler},getJasmineRequireObj().ExceptionFormatter=function(){function e(){this.message=function(e){var t=e.name+": "+e.message;return(e.fileName||e.sourceURL)&&(t+=" in "+(e.fileName||e.sourceURL)),(e.line||e.lineNumber)&&(t+=" (line "+(e.line||e.lineNumber)+")"),t},this.stack=function(e){return e?e.stack:null}}return e},getJasmineRequireObj().Expectation=function(){function e(e){this.util=e.util||{buildFailureMessage:function(){}},this.customEqualityTesters=e.customEqualityTesters||[],this.actual=e.actual,this.addExpectationResult=e.addExpectationResult||function(){},this.isNot=e.isNot;for(var n in t)this[n]=t[n]}var t={};return e.prototype.wrapCompare=function(e,t){return function(){function n(){var e=s.compare.apply(null,i);return e.pass=!e.pass,e}var i=Array.prototype.slice.call(arguments,0),r=i.slice(0),o="";i.unshift(this.actual);var s=t(this.util,this.customEqualityTesters),a=s.compare;this.isNot&&(a=s.negativeCompare||n);var l=a.apply(null,i);l.pass||(l.message?o=l.message:(i.unshift(this.isNot),i.unshift(e),o=this.util.buildFailureMessage.apply(null,i))),1==r.length&&(r=r[0]),this.addExpectationResult(l.pass,{matcherName:e,passed:l.pass,message:o,actual:this.actual,expected:r})}},e.addCoreMatchers=function(t){var n=e.prototype;for(var i in t){var r=t[i];n[i]=n.wrapCompare(i,r)}},e.addMatchers=function(n){for(var i in n){var r=n[i];t[i]=e.prototype.wrapCompare(i,r)}},e.resetMatchers=function(){for(var e in t)delete t[e]},e.Factory=function(t){t=t||{};var n=new e(t);return t.isNot=!0,n.not=new e(t),n},e},getJasmineRequireObj().buildExpectationResult=function(){function e(e){function t(){return e.passed?"Passed.":e.message?e.message:e.error?i(e.error):""}function n(){if(e.passed)return"";var n=e.error;if(!n)try{throw new Error(t())}catch(i){n=i}return r(n)}var i=e.messageFormatter||function(){},r=e.stackFormatter||function(){};return{matcherName:e.matcherName,expected:e.expected,actual:e.actual,message:t(),stack:n(),passed:e.passed}}return e},getJasmineRequireObj().ObjectContaining=function(e){function t(e){this.sample=e}return t.prototype.jasmineMatches=function(t,n,i){if("object"!=typeof this.sample)throw new Error("You must provide an object to objectContaining, not '"+this.sample+"'.");n=n||[],i=i||[];var r=function(t,n){return null!==t&&!e.util.isUndefined(t[n])};for(var o in this.sample)!r(t,o)&&r(this.sample,o)?n.push("expected has key '"+o+"', but missing from actual."):e.matchersUtil.equals(this.sample[o],t[o])||i.push("'"+o+"' was '"+(t[o]?e.util.htmlEscape(t[o].toString()):t[o])+"' in actual, but was '"+(this.sample[o]?e.util.htmlEscape(this.sample[o].toString()):this.sample[o])+"' in expected.");return 0===n.length&&0===i.length},t.prototype.jasmineToString=function(){return"<jasmine.objectContaining("+e.pp(this.sample)+")>"},t},getJasmineRequireObj().pp=function(e){function t(){this.ppNestLevel_=0}function n(){t.call(this),this.string=""}return t.prototype.format=function(t){this.ppNestLevel_++;try{e.util.isUndefined(t)?this.emitScalar("undefined"):null===t?this.emitScalar("null"):t===e.getGlobal()?this.emitScalar("<global>"):t.jasmineToString?this.emitScalar(t.jasmineToString()):"string"==typeof t?this.emitString(t):e.isSpy(t)?this.emitScalar("spy on "+t.and.identity()):t instanceof RegExp?this.emitScalar(t.toString()):"function"==typeof t?this.emitScalar("Function"):"number"==typeof t.nodeType?this.emitScalar("HTMLNode"):t instanceof Date?this.emitScalar("Date("+t+")"):t.__Jasmine_been_here_before__?this.emitScalar("<circular reference: "+(e.isArray_(t)?"Array":"Object")+">"):e.isArray_(t)||e.isA_("Object",t)?(t.__Jasmine_been_here_before__=!0,e.isArray_(t)?this.emitArray(t):this.emitObject(t),delete t.__Jasmine_been_here_before__):this.emitScalar(t.toString())}finally{this.ppNestLevel_--}},t.prototype.iterateObject=function(t,n){for(var i in t)t.hasOwnProperty(i)&&"__Jasmine_been_here_before__"!=i&&n(i,t.__lookupGetter__?!e.util.isUndefined(t.__lookupGetter__(i))&&null!==t.__lookupGetter__(i):!1)},t.prototype.emitArray=e.unimplementedMethod_,t.prototype.emitObject=e.unimplementedMethod_,t.prototype.emitScalar=e.unimplementedMethod_,t.prototype.emitString=e.unimplementedMethod_,e.util.inherit(n,t),n.prototype.emitScalar=function(e){this.append(e)},n.prototype.emitString=function(e){this.append("'"+e+"'")},n.prototype.emitArray=function(t){if(this.ppNestLevel_>e.MAX_PRETTY_PRINT_DEPTH)return void this.append("Array");this.append("[ ");for(var n=0;n<t.length;n++)n>0&&this.append(", "),this.format(t[n]);this.append(" ]")},n.prototype.emitObject=function(t){if(this.ppNestLevel_>e.MAX_PRETTY_PRINT_DEPTH)return void this.append("Object");var n=this;this.append("{ ");var i=!0;this.iterateObject(t,function(e,r){i?i=!1:n.append(", "),n.append(e),n.append(" : "),r?n.append("<getter>"):n.format(t[e])}),this.append(" }")},n.prototype.append=function(e){this.string+=e},function(e){var t=new n;return t.format(e),t.string}},getJasmineRequireObj().QueueRunner=function(){function e(e){this.fns=e.fns||[],this.onComplete=e.onComplete||function(){},this.clearStack=e.clearStack||function(e){e()},this.onException=e.onException||function(){},this.catchException=e.catchException||function(){return!0},this.userContext={}}return e.prototype.execute=function(){this.run(this.fns,0)},e.prototype.run=function(e,t){function n(e){try{e.call(a.userContext)}catch(t){r(t)}}function i(t){var n=function(){a.run(e,o+1)};try{t.call(a.userContext,n)}catch(i){r(i),n()}}function r(e){if(a.onException(e),!a.catchException(e))throw e}var o,s=e.length,a=this;for(o=t;s>o;o++){var l=e[o];if(l.length>0)return i(l);n(l)}var c=o>=s;c&&this.clearStack(this.onComplete)},e},getJasmineRequireObj().ReportDispatcher=function(){function e(e){function t(e,t){for(var n=0;n<o.length;n++){var i=o[n];i[e]&&i[e].apply(i,t)}}for(var n=e||[],i=0;i<n.length;i++){var r=n[i];this[r]=function(e){return function(){t(e,arguments)}}(r)}var o=[];return this.addReporter=function(e){o.push(e)},this}return e},getJasmineRequireObj().SpyStrategy=function(){function e(e){e=e||{};var t=e.name||"unknown",n=e.fn||function(){},i=e.getSpy||function(){},r=function(){};this.identity=function(){return t},this.exec=function(){return r.apply(this,arguments)},this.callThrough=function(){return r=n,i()},this.returnValue=function(e){return r=function(){return e},i()},this.throwError=function(e){var t=e instanceof Error?e:new Error(e);return r=function(){throw t},i()},this.callFake=function(e){return r=e,i()},this.stub=function(e){return r=function(){},i()}}return e},getJasmineRequireObj().Suite=function(){function e(e){this.env=e.env,this.id=e.id,this.parentSuite=e.parentSuite,this.description=e.description,this.onStart=e.onStart||function(){},this.resultCallback=e.resultCallback||function(){},this.clearStack=e.clearStack||function(e){e()},this.beforeFns=[],this.afterFns=[],this.queueRunner=e.queueRunner||function(){},this.disabled=!1,this.children=[],this.result={id:this.id,status:this.disabled?"disabled":"",description:this.description,fullName:this.getFullName()}}return e.prototype.getFullName=function(){for(var e=this.description,t=this.parentSuite;t;t=t.parentSuite)t.parentSuite&&(e=t.description+" "+e);return e},e.prototype.disable=function(){this.disabled=!0},e.prototype.beforeEach=function(e){this.beforeFns.unshift(e)},e.prototype.afterEach=function(e){this.afterFns.unshift(e)},e.prototype.addChild=function(e){this.children.push(e)},e.prototype.execute=function(e){function t(){i.resultCallback(i.result),e&&e()}function n(e){return function(t){e.execute(t)}}var i=this;if(this.disabled)return void t();for(var r=[],o=0;o<this.children.length;o++)r.push(n(this.children[o]));this.onStart(this),this.queueRunner({fns:r,onComplete:t})},e},void 0==typeof window&&"object"==typeof exports&&(exports.Suite=jasmineRequire.Suite),getJasmineRequireObj().Timer=function(){function e(e){e=e||{};var t,n=e.now||function(){return(new Date).getTime()};this.start=function(){t=n()},this.elapsed=function(){return n()-t}}return e},getJasmineRequireObj().matchersUtil=function(e){function t(n,i,r,o,s){function a(e,t){return e.hasOwnProperty(t)}function l(e){return"function"==typeof e}for(var c=!0,u=0;u<s.length;u++){var f=s[u](n,i);if(!e.util.isUndefined(f))return f}if(n instanceof e.Any&&(c=n.jasmineMatches(i)))return!0;if(i instanceof e.Any&&(c=i.jasmineMatches(n)))return!0;if(i instanceof e.ObjectContaining&&(c=i.jasmineMatches(n)))return!0;if(n instanceof Error&&i instanceof Error)return n.message==i.message;if(n===i)return 0!==n||1/n==1/i;if(null===n||null===i)return n===i;var h=Object.prototype.toString.call(n);if(h!=Object.prototype.toString.call(i))return!1;switch(h){case"[object String]":return n==String(i);case"[object Number]":return n!=+n?i!=+i:0===n?1/n==1/i:n==+i;case"[object Date]":case"[object Boolean]":return+n==+i;case"[object RegExp]":return n.source==i.source&&n.global==i.global&&n.multiline==i.multiline&&n.ignoreCase==i.ignoreCase}if("object"!=typeof n||"object"!=typeof i)return!1;for(var p=r.length;p--;)if(r[p]==n)return o[p]==i;r.push(n),o.push(i);var g=0;if("[object Array]"==h){if(g=n.length,c=g==i.length)for(;g--&&(c=t(n[g],i[g],r,o,s)););}else{var d=n.constructor,m=i.constructor;if(d!==m&&!(l(d)&&d instanceof d&&l(m)&&m instanceof m))return!1;for(var v in n)if(a(n,v)&&(g++,!(c=a(i,v)&&t(n[v],i[v],r,o,s))))break;if(c){for(v in i)if(a(i,v)&&!g--)break;c=!g}}return r.pop(),o.pop(),c}return{equals:function(e,n,i){return i=i||[],t(e,n,[],[],i)},contains:function(e,n,i){if(i=i||[],"[object Array]"===Object.prototype.toString.apply(e)){for(var r=0;r<e.length;r++)if(t(e[r],n,[],[],i))return!0;return!1}return e.indexOf(n)>=0},buildFailureMessage:function(){var t=Array.prototype.slice.call(arguments,0),n=t[0],i=t[1],r=t[2],o=t.slice(3),s=n.replace(/[A-Z]/g,function(e){return" "+e.toLowerCase()}),a="Expected "+e.pp(r)+(i?" not ":" ")+s;if(o.length>0)for(var l=0;l<o.length;l++)l>0&&(a+=","),a+=" "+e.pp(o[l]);return a+"."}}},getJasmineRequireObj().toBe=function(){function e(){return{compare:function(e,t){return{pass:e===t}}}}return e},getJasmineRequireObj().toBeCloseTo=function(){function e(){return{compare:function(e,t,n){return 0!==n&&(n=n||2),{pass:Math.abs(t-e)<Math.pow(10,-n)/2}}}}return e},getJasmineRequireObj().toBeDefined=function(){function e(){return{compare:function(e){return{pass:void 0!==e}}}}return e},getJasmineRequireObj().toBeFalsy=function(){function e(){return{compare:function(e){return{pass:!e}}}}return e},getJasmineRequireObj().toBeGreaterThan=function(){function e(){return{compare:function(e,t){return{pass:e>t}}}}return e},getJasmineRequireObj().toBeLessThan=function(){function e(){return{compare:function(e,t){return{pass:t>e}}}}return e},getJasmineRequireObj().toBeNaN=function(e){function t(){return{compare:function(t){var n={pass:t!==t};return n.pass?n.message="Expected actual not to be NaN.":n.message="Expected "+e.pp(t)+" to be NaN.",n}}}return t},getJasmineRequireObj().toBeNull=function(){function e(){return{compare:function(e){return{pass:null===e}}}}return e},getJasmineRequireObj().toBeTruthy=function(){function e(){return{compare:function(e){return{pass:!!e}}}}return e},getJasmineRequireObj().toBeUndefined=function(){function e(){return{compare:function(e){return{pass:void 0===e}}}}return e},getJasmineRequireObj().toContain=function(){function e(e,t){return t=t||[],{compare:function(n,i){return{pass:e.contains(n,i,t)}}}}return e},getJasmineRequireObj().toEqual=function(){function e(e,t){return t=t||[],{compare:function(n,i){var r={pass:!1};return r.pass=e.equals(n,i,t),r}}}return e},getJasmineRequireObj().toHaveBeenCalled=function(e){function t(){return{compare:function(t){var n={};if(!e.isSpy(t))throw new Error("Expected a spy, but got "+e.pp(t)+".");if(arguments.length>1)throw new Error("toHaveBeenCalled does not take arguments, use toHaveBeenCalledWith");return n.pass=t.calls.any(),n.message=n.pass?"Expected spy "+t.and.identity()+" not to have been called.":"Expected spy "+t.and.identity()+" to have been called.",n}}}return t},getJasmineRequireObj().toHaveBeenCalledWith=function(e){function t(t){return{compare:function(){var n=Array.prototype.slice.call(arguments,0),i=n[0],r=n.slice(1),o={pass:!1};if(!e.isSpy(i))throw new Error("Expected a spy, but got "+e.pp(i)+".");return i.calls.any()?(t.contains(i.calls.allArgs(),r)?(o.pass=!0,o.message="Expected spy "+i.and.identity()+" not to have been called with "+e.pp(r)+" but it was."):o.message="Expected spy "+i.and.identity()+" to have been called with "+e.pp(r)+" but actual calls were "+e.pp(i.calls.allArgs()).replace(/^\[ | \]$/g,"")+".",o):(o.message="Expected spy "+i.and.identity()+" to have been called with "+e.pp(r)+" but it was never called.",o)}}}return t},getJasmineRequireObj().toMatch=function(){function e(){return{compare:function(e,t){var n=new RegExp(t);return{pass:n.test(e)}}}}return e},getJasmineRequireObj().toThrow=function(e){function t(t){return{compare:function(n,i){var r,o={pass:!1},s=!1;if("function"!=typeof n)throw new Error("Actual is not a Function");try{n()}catch(a){s=!0,r=a}return s?1==arguments.length?(o.pass=!0,o.message="Expected function not to throw, but it threw "+e.pp(r)+".",o):(t.equals(r,i)?(o.pass=!0,o.message="Expected function not to throw "+e.pp(i)+"."):o.message="Expected function to throw "+e.pp(i)+", but it threw "+e.pp(r)+".",o):(o.message="Expected function to throw an exception.",o)}}}return t},getJasmineRequireObj().toThrowError=function(e){function t(t){return{compare:function(n){function i(e){return e.name||e.toString().match(/^\s*function\s*(\w*)\s*\(/)[1]}function r(e){return{pass:!0,message:e}}function o(e){return{pass:!1,message:e}}function s(){if(1!=arguments.length)if(2==arguments.length){var e=arguments[1];if(e instanceof RegExp?f=e:"string"==typeof e?u=e:a(e)&&(c=e),!(c||u||f))throw new Error("Expected is not an Error, string, or RegExp.")}else{if(!a(arguments[1]))throw new Error("Expected error type is not an Error.");if(c=arguments[1],arguments[2]instanceof RegExp)f=arguments[2];else{if("string"!=typeof arguments[2])throw new Error("Expected error message is not a string or RegExp.");u=arguments[2]}}}function a(e){if("function"!=typeof e)return!1;var t=function(){};return t.prototype=e.prototype,new t instanceof Error}var l,c,u,f,h,p,g=!1;if("function"!=typeof n)throw new Error("Actual is not a Function");s.apply(null,arguments);try{n()}catch(d){g=!0,l=d}return g?l instanceof Error?1==arguments.length?r("Expected function not to throw an Error, but it threw "+i(l)+"."):(c&&(h=i(c),p=i(l.constructor)),c&&u?l.constructor==c&&t.equals(l.message,u)?r("Expected function not to throw "+h+' with message "'+u+'".'):o("Expected function to throw "+h+' with message "'+u+'", but it threw '+p+' with message "'+l.message+'".'):c&&f?l.constructor==c&&f.test(l.message)?r("Expected function not to throw "+h+" with message matching "+f+"."):o("Expected function to throw "+h+" with message matching "+f+", but it threw "+p+' with message "'+l.message+'".'):c?l.constructor==c?r("Expected function not to throw "+h+"."):o("Expected function to throw "+h+", but it threw "+p+"."):u?l.message==u?r("Expected function not to throw an exception with message "+e.pp(u)+"."):o("Expected function to throw an exception with message "+e.pp(u)+", but it threw an exception with message "+e.pp(l.message)+"."):f?f.test(l.message)?r("Expected function not to throw an exception with a message matching "+e.pp(f)+"."):o("Expected function to throw an exception with a message matching "+e.pp(f)+", but it threw an exception with message "+e.pp(l.message)+"."):void 0):o("Expected function to throw an Error, but it threw "+l+"."):o("Expected function to throw an Error.")}}}return t},getJasmineRequireObj().version=function(){return"2.0.0"};var ServerDate=function(e){function t(){return this?t:t.toString()}function n(e,t){this.value=e,this.precision=t}function i(e){var n,i="Set target to "+String(e);p&&(i+=" ("+(e>p?"+":"-")+" "+Math.abs(e-p)+" ms)"),p=e,o(i+"."),n=Math.abs(p-c),n>t.amortizationThreshold&&(o("Difference between target and offset too high ("+n+" ms); skipping amortization."),c=p)}function r(){function e(){var e=new XMLHttpRequest;e.open("GET",h+"?noCache="+Date.now()),e.onreadystatechange=function(){this.readyState==this.HEADERS_RECEIVED&&200==this.status&&(s=Date.now())},e.onload=function(){if(200==this.status)try{t(new Date(this.getResponseHeader("Date")).getTime())}catch(e){o("Unable to read the server's response.")}},r=Date.now(),e.send()}function t(t){var c=(s-r)/2,u=new n(t+c-s,c);o("sample: "+l+", offset: "+String(u)),(1==l||c<=a.precision)&&(a=u),10>l?(l++,e()):(i(a),g=!1)}var r,s,a,l=1;g||(g=!0,setTimeout(function(){g=!1},1e4),e())}function o(e){console&&console.log}var s,a,l,c,u=Date.now(),f=document.getElementsByTagName("script"),h=f[f.length-1].src,p=null,g=!1;return t.parse=Date.parse,t.UTC=Date.UTC,t.now=function(){return Date.now()+c},["toString","toDateString","toTimeString","toLocaleString","toLocaleDateString","toLocaleTimeString","valueOf","getTime","getFullYear","getUTCFullYear","getMonth","getUTCMonth","getDate","getUTCDate","getDay","getUTCDay","getHours","getUTCHours","getMinutes","getUTCMinutes","getSeconds","getUTCSeconds","getMilliseconds","getUTCMilliseconds","getTimezoneOffset","toUTCString","toISOString","toJSON"].forEach(function(e){t[e]=function(){return new Date(t.now())[e]()}}),t.getPrecision=function(){return"undefined"!=typeof p.precision?p.precision+Math.abs(p-c):void 0},t.amortizationRate=25,t.amortizationThreshold=2e3,Object.defineProperty(t,"synchronizationIntervalDelay",{get:function(){return s},set:function(e){s=e,clearInterval(a),a=setInterval(r,t.synchronizationIntervalDelay),o("Set synchronizationIntervalDelay to "+e+" ms.")}}),t.synchronizationIntervalDelay=1e4,n.prototype.valueOf=function(){return this.value},n.prototype.toString=function(){return this.value+("undefined"!=typeof this.precision?" +/- "+this.precision:"")+" ms"},c=e-u,"undefined"!=typeof performance&&(l=(u-performance.timing.domLoading)/2,c+=l),i(new n(c,l)),setInterval(function(){var e=Math.max(-t.amortizationRate,Math.min(t.amortizationRate,p-c));c+=e,e&&o("Offset adjusted by "+e+" ms to "+c+" ms (target: "+p.value+" ms).")},1e3),window.addEventListener("pageshow",r),r(),t}(Date.now());
